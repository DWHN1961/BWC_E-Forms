<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Economic Substance Declaration | Bethel Worldwide Corporation</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@600&family=Crimson+Pro:wght@400;600&display=swap" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            min-height: 100vh;
            background: linear-gradient(135deg, #1e3a5f 0%, #2d5986 100%);
            padding: 40px 20px;
            font-family: 'Crimson Pro', Georgia, serif;
        }

        .container {
            max-width: 1000px;
            margin: 0 auto;
            background: white;
            border-radius: 12px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, #2d5986 0%, #1e3a5f 100%);
            padding: 40px;
            color: white;
            text-align: center;
            border-bottom: 4px solid #d4af37;
        }

        .header h1 {
            margin: 0 0 10px 0;
            font-size: 28px;
            font-weight: 600;
            letter-spacing: 1px;
            text-transform: uppercase;
            font-family: 'Playfair Display', Georgia, serif;
        }

        .header h2 {
            margin: 10px 0 0 0;
            font-size: 18px;
            font-weight: 500;
            opacity: 0.95;
        }

        .form-content {
            padding: 40px;
        }

        .section {
            margin-bottom: 35px;
        }

        .section-title {
            font-size: 20px;
            color: #1e3a5f;
            margin-bottom: 20px;
            border-bottom: 2px solid #d4af37;
            padding-bottom: 8px;
            font-family: 'Playfair Display', Georgia, serif;
            text-transform: uppercase;
        }

        .subsection-title {
            font-size: 16px;
            color: #2d5986;
            margin: 20px 0 15px 0;
            font-weight: 600;
        }

        .form-group {
            margin-bottom: 20px;
        }

        label {
            display: block;
            margin-bottom: 6px;
            font-weight: 600;
            color: #333;
            font-size: 15px;
        }

        .required {
            color: #dc2626;
        }

        input[type="text"],
        input[type="date"],
        select,
        textarea {
            width: 100%;
            padding: 12px;
            border: 2px solid #d1d5db;
            border-radius: 6px;
            font-size: 16px;
            font-family: inherit;
            transition: border-color 0.2s;
        }

        input:focus,
        select:focus,
        textarea:focus {
            outline: none;
            border-color: #2d5986;
        }

        input.error,
        select.error,
        textarea.error {
            border-color: #dc2626;
        }

        .error-message {
            color: #dc2626;
            font-size: 14px;
            margin-top: 4px;
            display: block;
        }

        .radio-group {
            display: flex;
            gap: 20px;
            margin-top: 10px;
        }

        .radio-label {
            display: flex;
            align-items: center;
            cursor: pointer;
            font-weight: normal;
        }

        input[type="radio"] {
            margin-right: 8px;
            width: 18px;
            height: 18px;
            cursor: pointer;
        }

        .grid-2 {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
        }

        .grid-3 {
            display: grid;
            grid-template-columns: 1fr 1fr 1fr;
            gap: 15px;
        }

        .info-box {
            background-color: #dbeafe;
            padding: 15px;
            border-radius: 6px;
            border: 1px solid #60a5fa;
            font-size: 14px;
            margin-bottom: 20px;
            line-height: 1.6;
        }

        .fixed-field {
            background-color: #f3f4f6;
            padding: 12px;
            border: 2px solid #d1d5db;
            border-radius: 6px;
            font-size: 16px;
            color: #4b5563;
        }

        .person-block {
            border: 2px solid #e5e7eb;
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 15px;
            background-color: #f9fafb;
        }

        .person-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 2px solid #d1d5db;
        }

        .person-title {
            font-size: 16px;
            font-weight: 600;
            color: #2d5986;
        }

        .btn {
            padding: 12px 24px;
            font-size: 16px;
            font-weight: 600;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.2s;
            font-family: inherit;
        }

        .btn-primary {
            background-color: #2d5986;
            color: white;
        }

        .btn-primary:hover {
            background-color: #1e3a5f;
        }

        .btn-secondary {
            background-color: #6b7280;
            color: white;
            padding: 16px 48px;
            font-size: 18px;
            font-weight: 600;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.2s;
            font-family: inherit;
        }

        .btn-secondary:hover {
            background-color: #4b5563;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
        }

        .btn-danger {
            background-color: #ef4444;
            color: white;
            padding: 8px 16px;
            font-size: 14px;
        }

        .btn-danger:hover {
            background-color: #dc2626;
        }

        .submit-section {
            text-align: center;
            margin-top: 40px;
            padding-top: 30px;
            border-top: 3px solid #d4af37;
        }

        .btn-submit {
            padding: 16px 48px;
            background-color: #2d5986;
            color: white;
            font-size: 18px;
            font-weight: 600;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.2s;
            font-family: inherit;
        }

        .btn-submit:hover {
            background-color: #1e3a5f;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
        }

        .submit-note {
            margin-top: 15px;
            font-size: 14px;
            color: #666;
        }

        /* Loading Spinner Styles */
        .spinner-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.7);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 9999;
        }

        .spinner-content {
            text-align: center;
            background: white;
            padding: 40px;
            border-radius: 12px;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.3);
        }

        .spinner {
            border: 4px solid #f3f4f6;
            border-top: 4px solid #2d5986;
            border-radius: 50%;
            width: 50px;
            height: 50px;
            animation: spin 1s linear infinite;
            margin: 0 auto 20px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .spinner-text {
            color: #1e3a5f;
            font-size: 16px;
            font-weight: 600;
            margin: 0;
        }

        .footer {
            background-color: #f3f4f6;
            padding: 20px;
            text-align: center;
            font-size: 13px;
            color: #666;
            border-top: 1px solid #e5e7eb;
        }

        .footer p {
            margin: 5px 0;
        }

        /* Floating Save Button */
        .floating-save-btn {
            position: fixed;
            top: 20px;
            right: 20px;
            background: linear-gradient(135deg, #2d5986 0%, #1e3a5f 100%);
            color: white;
            border: none;
            border-radius: 50px;
            padding: 14px 28px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
            z-index: 1000;
            display: flex;
            align-items: center;
            gap: 8px;
            transition: all 0.3s ease;
            font-family: 'Crimson Pro', Georgia, serif;
        }

        .floating-save-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 16px rgba(0, 0, 0, 0.4);
            background: linear-gradient(135deg, #1e3a5f 0%, #2d5986 100%);
        }

        .floating-save-btn:active {
            transform: translateY(0);
        }

        .save-icon {
            font-size: 18px;
        }

        @media (max-width: 768px) {
            .header h1 {
                font-size: 22px;
            }

            .form-content {
                padding: 20px;
            }

            .grid-2,
            .grid-3 {
                grid-template-columns: 1fr;
            }

            .floating-save-btn {
                top: 10px;
                right: 10px;
                padding: 10px 20px;
                font-size: 14px;
            }

            .save-icon {
                font-size: 16px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Header -->
        <div class="header">
            <h1>Bethel Worldwide Corporation</h1>
            <h2>Economic Substance Declaration</h2>
        </div>

        <!-- Form Content -->
        <div class="form-content">
            <form id="esForm">
                
                <!-- Save/Resume Controls -->
                <div style="background-color: #e0f2fe; border: 2px solid #0284c7; border-radius: 8px; padding: 20px; margin-bottom: 35px;">
                    <div style="display: flex; justify-content: space-between; align-items: center; flex-wrap: wrap; gap: 15px;">
                        <div style="flex: 1;">
                            <p style="margin: 0 0 5px 0; font-weight: 600; color: #075985; font-size: 16px;">üíæ Auto-Save Active</p>
                            <p id="saveStatus" style="margin: 0; color: #075985; font-size: 14px;">Your progress is automatically saved every 30 seconds. You can also save manually.</p>
                            <p id="lastSavedTime" style="margin: 5px 0 0 0; color: #0369a1; font-size: 13px; font-style: italic;"></p>
                        </div>
                        <div style="display: flex; gap: 10px; flex-shrink: 0;">
                            <button type="button" class="btn btn-secondary" onclick="loadFormProgress()" style="white-space: nowrap;">üìÇ Load Saved Data</button>
                            <button type="button" class="btn btn-secondary" onclick="saveFormProgress()" style="white-space: nowrap;">üíæ Save Now</button>
                            <button type="button" class="btn btn-secondary" onclick="clearSavedProgress()" style="white-space: nowrap;">üóëÔ∏è Clear Saved Data</button>
                        </div>
                    </div>
                </div>

                <!-- Financial Period -->
                <div class="section">
                    <h3 class="section-title">Financial Period</h3>
                    
                    <div class="grid-2">
                        <div class="form-group">
                            <label>Financial Period Start Date <span class="required">*</span></label>
                            <input type="date" id="periodStartDate" required>
                            <span class="error-message" id="error-periodStartDate"></span>
                        </div>

                        <div class="form-group">
                            <label>Financial Period End Date <span class="required">*</span></label>
                            <input type="date" id="periodEndDate" required>
                            <span class="error-message" id="error-periodEndDate"></span>
                        </div>
                    </div>
                </div>

                <!-- Entity Information -->
                <div class="section">
                    <h3 class="section-title">Entity Information</h3>
                    
                    <div class="form-group">
                        <label>Entity Name <span class="required">*</span></label>
                        <input type="text" id="entityName" placeholder="Enter entity name" maxlength="200" required>
                        <span class="error-message" id="error-entityName"></span>
                    </div>

                    <div class="grid-2">
                        <div class="form-group">
                            <label>Entity Number <span class="required">*</span></label>
                            <input type="text" id="entityNumber" placeholder="Enter entity number" maxlength="50" required>
                            <span class="error-message" id="error-entityNumber"></span>
                        </div>
                        <div class="form-group">
                            <label>Date of Incorporation / Registration <span class="required">*</span></label>
                            <input type="date" id="incorporationDate" required>
                            <span class="error-message" id="error-incorporationDate"></span>
                        </div>
                    </div>

                    <div class="form-group">
                        <label>Entity Status</label>
                        <div class="fixed-field">Active</div>
                    </div>

                    <div class="form-group">
                        <label>Entity Type <span class="required">*</span></label>
                        <select id="entityType" required>
                            <option value="">Select Entity Type</option>
                            <option value="BC Company">BC Company</option>
                            <option value="Limited Partnership">Limited Partnership</option>
                        </select>
                        <span class="error-message" id="error-entityType"></span>
                    </div>

                    <div class="subsection-title">Registered Office Address</div>
                    <div class="fixed-field">
                        Bethel House<br>
                        P.O. Box 4749<br>
                        Road Town<br>
                        Tortola<br>
                        VG1110<br>
                        British Virgin Islands
                    </div>

                    <div class="form-group" style="margin-top: 25px;">
                        <label><strong>Is Business Address same as Registered Office Address?</strong></label>
                        <div class="radio-group">
                            <label class="radio-label">
                                <input type="radio" name="sameAddress" value="yes" onchange="toggleBusinessAddress()">
                                <span>Yes</span>
                            </label>
                            <label class="radio-label">
                                <input type="radio" name="sameAddress" value="no" onchange="toggleBusinessAddress()">
                                <span>No</span>
                            </label>
                        </div>
                    </div>

                    <div id="businessAddressFields" style="display: none;">
                        <div class="subsection-title">Business Address</div>
                        <div class="form-group">
                            <label>Address <span class="required">*</span></label>
                            <input type="text" id="businessAddress" placeholder="Address line 1" maxlength="200">
                            <span class="error-message" id="error-businessAddress"></span>
                        </div>
                        <div class="form-group">
                            <label>Street</label>
                            <input type="text" id="businessStreet" placeholder="Street" maxlength="150">
                        </div>
                        <div class="grid-2">
                            <div class="form-group">
                                <label>City <span class="required">*</span></label>
                                <input type="text" id="businessCity" placeholder="City" maxlength="100">
                                <span class="error-message" id="error-businessCity"></span>
                            </div>
                            <div class="form-group">
                                <label>State/Province</label>
                                <input type="text" id="businessState" placeholder="State/Province" maxlength="100">
                            </div>
                        </div>
                        <div class="grid-2">
                            <div class="form-group">
                                <label>Postal Code</label>
                                <input type="text" id="businessPostal" placeholder="Postal Code" maxlength="20">
                            </div>
                            <div class="form-group">
                                <label>Country <span class="required">*</span></label>
                                <select id="businessCountry">
                                    <option value="">Select Country</option>
                                </select>
                                <span class="error-message" id="error-businessCountry"></span>
                            </div>
                        </div>
                    </div>

                    <div class="grid-2" style="margin-top: 20px;">
                        <div class="form-group">
                            <label>Tax Identification No. (TIN)</label>
                            <input type="text" id="tin" placeholder="Enter TIN" maxlength="50">
                        </div>
                        <div class="form-group">
                            <label>Issued by (TIN)</label>
                            <select id="tinCountry">
                                <option value="">Select Country</option>
                            </select>
                        </div>
                    </div>

                    <div class="grid-3">
                        <div class="form-group">
                            <label>Other Identification No.</label>
                            <input type="text" id="otherIdNo" placeholder="Enter ID number" maxlength="50">
                        </div>
                        <div class="form-group">
                            <label>ID Type</label>
                            <input type="text" id="otherIdType" placeholder="Enter ID type">
                        </div>
                        <div class="form-group">
                            <label>Issued by</label>
                            <select id="otherIdCountry">
                                <option value="">Select Country</option>
                            </select>
                        </div>
                    </div>

                    <div class="form-group">
                        <label><strong>Is the entity part of a MNE Group? <span class="required">*</span></strong></label>
                        <div class="radio-group">
                            <label class="radio-label">
                                <input type="radio" name="mneGroup" value="yes">
                                <span>Yes</span>
                            </label>
                            <label class="radio-label">
                                <input type="radio" name="mneGroup" value="no">
                                <span>No</span>
                            </label>
                        </div>
                    </div>

                    <div class="form-group">
                        <label><strong>Does the entity have an ultimate parent entity? <span class="required">*</span></strong></label>
                        <div class="radio-group">
                            <label class="radio-label">
                                <input type="radio" name="ultimateParent" value="yes">
                                <span>Yes</span>
                            </label>
                            <label class="radio-label">
                                <input type="radio" name="ultimateParent" value="no">
                                <span>No</span>
                            </label>
                        </div>
                    </div>

                    <div class="form-group">
                        <label><strong>Does the entity have an immediate parent entity? <span class="required">*</span></strong></label>
                        <div class="radio-group">
                            <label class="radio-label">
                                <input type="radio" name="immediateParent" value="yes">
                                <span>Yes</span>
                            </label>
                            <label class="radio-label">
                                <input type="radio" name="immediateParent" value="no">
                                <span>No</span>
                            </label>
                        </div>
                    </div>
                </div>

                <!-- Agent Details -->
                <div class="section">
                    <h3 class="section-title">Agent Details</h3>
                    
                    <div class="form-group">
                        <label>Agent Name</label>
                        <div class="fixed-field">Bethel Worldwide Corporation</div>
                    </div>

                    <div class="subsection-title">Agent Address</div>
                    <div class="fixed-field">
                        Bethel House<br>
                        P.O. Box 4749<br>
                        Road Town<br>
                        Tortola<br>
                        VG1110<br>
                        British Virgin Islands
                    </div>
                </div>

                <!-- Beneficial Owner Details -->
                <div class="section">
                    <h3 class="section-title">Beneficial Owner Details</h3>
                    
                    <div class="info-box">
                        <strong>Note:</strong> At least one beneficial owner is required. You can add multiple beneficial owners using the "+ Add Another Beneficial Owner" button.
                    </div>

                    <div id="beneficialOwnersContainer"></div>
                    
                    <button type="button" class="btn btn-primary" onclick="addBeneficialOwner()">+ Add Another Beneficial Owner</button>
                </div>

                <!-- Economic Substance Declaration -->
                <div class="section">
                    <h3 class="section-title">Economic Substance Declaration</h3>
                    
                    <div class="form-group">
                        <label>Declaration Type <span class="required">*</span></label>
                        <select id="declarationType" onchange="toggleDeclarationFields()" required>
                            <option value="">Select Declaration Type</option>
                            <option value="1">1 - Entity Conducting a Relevant Activity</option>
                            <option value="2">2 - Provisional Treatment Application</option>
                            <option value="3">3 - Claim of Non-Residence</option>
                            <option value="4">4 - Entity NOT Conducting a Relevant Activity</option>
                        </select>
                        <span class="error-message" id="error-declarationType"></span>
                    </div>

                    <!-- Fields shown only when Declaration Type = 1 -->
                    <div id="relevantActivityFields" style="display: none;">
                        
                        <div class="grid-2">
                            <div class="form-group">
                                <label>Reporting Currency <span class="required">*</span></label>
                                <select id="reportingCurrency">
                                    <option value="">Select Currency</option>
                                    <option value="AED">AED - United Arab Emirates Dirham</option>
                                    <option value="AFN">AFN - Afghan Afghani</option>
                                    <option value="ALL">ALL - Albanian Lek</option>
                                    <option value="AMD">AMD - Armenian Dram</option>
                                    <option value="ANG">ANG - Netherlands Antillean Guilder</option>
                                    <option value="AOA">AOA - Angolan Kwanza</option>
                                    <option value="ARS">ARS - Argentine Peso</option>
                                    <option value="AUD">AUD - Australian Dollar</option>
                                    <option value="AWG">AWG - Aruban Florin</option>
                                    <option value="AZN">AZN - Azerbaijani Manat</option>
                                    <option value="BAM">BAM - Bosnia-Herzegovina Convertible Mark</option>
                                    <option value="BBD">BBD - Barbadian Dollar</option>
                                    <option value="BDT">BDT - Bangladeshi Taka</option>
                                    <option value="BGN">BGN - Bulgarian Lev</option>
                                    <option value="BHD">BHD - Bahraini Dinar</option>
                                    <option value="BIF">BIF - Burundian Franc</option>
                                    <option value="BMD">BMD - Bermudan Dollar</option>
                                    <option value="BND">BND - Brunei Dollar</option>
                                    <option value="BOB">BOB - Bolivian Boliviano</option>
                                    <option value="BRL">BRL - Brazilian Real</option>
                                    <option value="BSD">BSD - Bahamian Dollar</option>
                                    <option value="BTN">BTN - Bhutanese Ngultrum</option>
                                    <option value="BWP">BWP - Botswanan Pula</option>
                                    <option value="BYN">BYN - Belarusian Ruble</option>
                                    <option value="BZD">BZD - Belize Dollar</option>
                                    <option value="CAD">CAD - Canadian Dollar</option>
                                    <option value="CDF">CDF - Congolese Franc</option>
                                    <option value="CHF">CHF - Swiss Franc</option>
                                    <option value="CLP">CLP - Chilean Peso</option>
                                    <option value="CNY">CNY - Chinese Yuan</option>
                                    <option value="COP">COP - Colombian Peso</option>
                                    <option value="CRC">CRC - Costa Rican Col√≥n</option>
                                    <option value="CUP">CUP - Cuban Peso</option>
                                    <option value="CVE">CVE - Cape Verdean Escudo</option>
                                    <option value="CZK">CZK - Czech Koruna</option>
                                    <option value="DJF">DJF - Djiboutian Franc</option>
                                    <option value="DKK">DKK - Danish Krone</option>
                                    <option value="DOP">DOP - Dominican Peso</option>
                                    <option value="DZD">DZD - Algerian Dinar</option>
                                    <option value="EGP">EGP - Egyptian Pound</option>
                                    <option value="ERN">ERN - Eritrean Nakfa</option>
                                    <option value="ETB">ETB - Ethiopian Birr</option>
                                    <option value="EUR">EUR - Euro</option>
                                    <option value="FJD">FJD - Fijian Dollar</option>
                                    <option value="FKP">FKP - Falkland Islands Pound</option>
                                    <option value="GBP">GBP - British Pound Sterling</option>
                                    <option value="GEL">GEL - Georgian Lari</option>
                                    <option value="GGP">GGP - Guernsey Pound</option>
                                    <option value="GHS">GHS - Ghanaian Cedi</option>
                                    <option value="GIP">GIP - Gibraltar Pound</option>
                                    <option value="GMD">GMD - Gambian Dalasi</option>
                                    <option value="GNF">GNF - Guinean Franc</option>
                                    <option value="GTQ">GTQ - Guatemalan Quetzal</option>
                                    <option value="GYD">GYD - Guyanaese Dollar</option>
                                    <option value="HKD">HKD - Hong Kong Dollar</option>
                                    <option value="HNL">HNL - Honduran Lempira</option>
                                    <option value="HRK">HRK - Croatian Kuna</option>
                                    <option value="HTG">HTG - Haitian Gourde</option>
                                    <option value="HUF">HUF - Hungarian Forint</option>
                                    <option value="IDR">IDR - Indonesian Rupiah</option>
                                    <option value="ILS">ILS - Israeli New Shekel</option>
                                    <option value="IMP">IMP - Manx Pound</option>
                                    <option value="INR">INR - Indian Rupee</option>
                                    <option value="IQD">IQD - Iraqi Dinar</option>
                                    <option value="IRR">IRR - Iranian Rial</option>
                                    <option value="ISK">ISK - Icelandic Kr√≥na</option>
                                    <option value="JEP">JEP - Jersey Pound</option>
                                    <option value="JMD">JMD - Jamaican Dollar</option>
                                    <option value="JOD">JOD - Jordanian Dinar</option>
                                    <option value="JPY">JPY - Japanese Yen</option>
                                    <option value="KES">KES - Kenyan Shilling</option>
                                    <option value="KGS">KGS - Kyrgystani Som</option>
                                    <option value="KHR">KHR - Cambodian Riel</option>
                                    <option value="KMF">KMF - Comorian Franc</option>
                                    <option value="KPW">KPW - North Korean Won</option>
                                    <option value="KRW">KRW - South Korean Won</option>
                                    <option value="KWD">KWD - Kuwaiti Dinar</option>
                                    <option value="KYD">KYD - Cayman Islands Dollar</option>
                                    <option value="KZT">KZT - Kazakhstani Tenge</option>
                                    <option value="LAK">LAK - Laotian Kip</option>
                                    <option value="LBP">LBP - Lebanese Pound</option>
                                    <option value="LKR">LKR - Sri Lankan Rupee</option>
                                    <option value="LRD">LRD - Liberian Dollar</option>
                                    <option value="LSL">LSL - Lesotho Loti</option>
                                    <option value="LYD">LYD - Libyan Dinar</option>
                                    <option value="MAD">MAD - Moroccan Dirham</option>
                                    <option value="MDL">MDL - Moldovan Leu</option>
                                    <option value="MGA">MGA - Malagasy Ariary</option>
                                    <option value="MKD">MKD - Macedonian Denar</option>
                                    <option value="MMK">MMK - Myanmar Kyat</option>
                                    <option value="MNT">MNT - Mongolian Tugrik</option>
                                    <option value="MOP">MOP - Macanese Pataca</option>
                                    <option value="MRU">MRU - Mauritanian Ouguiya</option>
                                    <option value="MUR">MUR - Mauritian Rupee</option>
                                    <option value="MVR">MVR - Maldivian Rufiyaa</option>
                                    <option value="MWK">MWK - Malawian Kwacha</option>
                                    <option value="MXN">MXN - Mexican Peso</option>
                                    <option value="MYR">MYR - Malaysian Ringgit</option>
                                    <option value="MZN">MZN - Mozambican Metical</option>
                                    <option value="NAD">NAD - Namibian Dollar</option>
                                    <option value="NGN">NGN - Nigerian Naira</option>
                                    <option value="NIO">NIO - Nicaraguan C√≥rdoba</option>
                                    <option value="NOK">NOK - Norwegian Krone</option>
                                    <option value="NPR">NPR - Nepalese Rupee</option>
                                    <option value="NZD">NZD - New Zealand Dollar</option>
                                    <option value="OMR">OMR - Omani Rial</option>
                                    <option value="PAB">PAB - Panamanian Balboa</option>
                                    <option value="PEN">PEN - Peruvian Nuevo Sol</option>
                                    <option value="PGK">PGK - Papua New Guinean Kina</option>
                                    <option value="PHP">PHP - Philippine Peso</option>
                                    <option value="PKR">PKR - Pakistani Rupee</option>
                                    <option value="PLN">PLN - Polish Zloty</option>
                                    <option value="PYG">PYG - Paraguayan Guarani</option>
                                    <option value="QAR">QAR - Qatari Rial</option>
                                    <option value="RON">RON - Romanian Leu</option>
                                    <option value="RSD">RSD - Serbian Dinar</option>
                                    <option value="RUB">RUB - Russian Ruble</option>
                                    <option value="RWF">RWF - Rwandan Franc</option>
                                    <option value="SAR">SAR - Saudi Riyal</option>
                                    <option value="SBD">SBD - Solomon Islands Dollar</option>
                                    <option value="SCR">SCR - Seychellois Rupee</option>
                                    <option value="SDG">SDG - Sudanese Pound</option>
                                    <option value="SEK">SEK - Swedish Krona</option>
                                    <option value="SGD">SGD - Singapore Dollar</option>
                                    <option value="SHP">SHP - Saint Helena Pound</option>
                                    <option value="SLL">SLL - Sierra Leonean Leone</option>
                                    <option value="SOS">SOS - Somali Shilling</option>
                                    <option value="SRD">SRD - Surinamese Dollar</option>
                                    <option value="SSP">SSP - South Sudanese Pound</option>
                                    <option value="STN">STN - S√£o Tom√© and Pr√≠ncipe Dobra</option>
                                    <option value="SYP">SYP - Syrian Pound</option>
                                    <option value="SZL">SZL - Swazi Lilangeni</option>
                                    <option value="THB">THB - Thai Baht</option>
                                    <option value="TJS">TJS - Tajikistani Somoni</option>
                                    <option value="TMT">TMT - Turkmenistani Manat</option>
                                    <option value="TND">TND - Tunisian Dinar</option>
                                    <option value="TOP">TOP - Tongan Pa ªanga</option>
                                    <option value="TRY">TRY - Turkish Lira</option>
                                    <option value="TTD">TTD - Trinidad and Tobago Dollar</option>
                                    <option value="TWD">TWD - New Taiwan Dollar</option>
                                    <option value="TZS">TZS - Tanzanian Shilling</option>
                                    <option value="UAH">UAH - Ukrainian Hryvnia</option>
                                    <option value="UGX">UGX - Ugandan Shilling</option>
                                    <option value="USD">USD - United States Dollar</option>
                                    <option value="UYU">UYU - Uruguayan Peso</option>
                                    <option value="UZS">UZS - Uzbekistan Som</option>
                                    <option value="VES">VES - Venezuelan Bol√≠var</option>
                                    <option value="VND">VND - Vietnamese Dong</option>
                                    <option value="VUV">VUV - Vanuatu Vatu</option>
                                    <option value="WST">WST - Samoan Tala</option>
                                    <option value="XAF">XAF - Central African CFA Franc</option>
                                    <option value="XCD">XCD - East Caribbean Dollar</option>
                                    <option value="XOF">XOF - West African CFA Franc</option>
                                    <option value="XPF">XPF - CFP Franc</option>
                                    <option value="YER">YER - Yemeni Rial</option>
                                    <option value="ZAR">ZAR - South African Rand</option>
                                    <option value="ZMW">ZMW - Zambian Kwacha</option>
                                    <option value="ZWL">ZWL - Zimbabwean Dollar</option>
                                </select>
                                <span class="error-message" id="error-reportingCurrency"></span>
                            </div>
                            <div class="form-group">
                                <label>Total Amount Gross Income <span class="required">*</span></label>
                                <input type="text" id="totalGrossIncome" placeholder="Enter amount" maxlength="50">
                                <span class="error-message" id="error-totalGrossIncome"></span>
                            </div>
                        </div>

                        <!-- Relevant Activities Section -->
                        <div class="subsection-title">Additional / Update Relevant Activity</div>
                        <div id="relevantActivitiesContainer"></div>
                        <button type="button" class="btn btn-primary" onclick="addRelevantActivity()">+ Add Another Relevant Activity</button>

                        <!-- Gross Income Section -->
                        <div class="subsection-title" style="margin-top: 30px;">Gross Income</div>
                        <div class="grid-2">
                            <div class="form-group">
                                <label>Reporting Currency <span class="required">*</span></label>
                                <select id="grossIncomeReportingCurrency">
                                    <option value="">Select Currency</option>
                                    <option value="AED">AED - United Arab Emirates Dirham</option>
                                    <option value="AFN">AFN - Afghan Afghani</option>
                                    <option value="ALL">ALL - Albanian Lek</option>
                                    <option value="AMD">AMD - Armenian Dram</option>
                                    <option value="ANG">ANG - Netherlands Antillean Guilder</option>
                                    <option value="AOA">AOA - Angolan Kwanza</option>
                                    <option value="ARS">ARS - Argentine Peso</option>
                                    <option value="AUD">AUD - Australian Dollar</option>
                                    <option value="AWG">AWG - Aruban Florin</option>
                                    <option value="AZN">AZN - Azerbaijani Manat</option>
                                    <option value="BAM">BAM - Bosnia-Herzegovina Convertible Mark</option>
                                    <option value="BBD">BBD - Barbadian Dollar</option>
                                    <option value="BDT">BDT - Bangladeshi Taka</option>
                                    <option value="BGN">BGN - Bulgarian Lev</option>
                                    <option value="BHD">BHD - Bahraini Dinar</option>
                                    <option value="BIF">BIF - Burundian Franc</option>
                                    <option value="BMD">BMD - Bermudan Dollar</option>
                                    <option value="BND">BND - Brunei Dollar</option>
                                    <option value="BOB">BOB - Bolivian Boliviano</option>
                                    <option value="BRL">BRL - Brazilian Real</option>
                                    <option value="BSD">BSD - Bahamian Dollar</option>
                                    <option value="BTN">BTN - Bhutanese Ngultrum</option>
                                    <option value="BWP">BWP - Botswanan Pula</option>
                                    <option value="BYN">BYN - Belarusian Ruble</option>
                                    <option value="BZD">BZD - Belize Dollar</option>
                                    <option value="CAD">CAD - Canadian Dollar</option>
                                    <option value="CDF">CDF - Congolese Franc</option>
                                    <option value="CHF">CHF - Swiss Franc</option>
                                    <option value="CLP">CLP - Chilean Peso</option>
                                    <option value="CNY">CNY - Chinese Yuan</option>
                                    <option value="COP">COP - Colombian Peso</option>
                                    <option value="CRC">CRC - Costa Rican Col√≥n</option>
                                    <option value="CUP">CUP - Cuban Peso</option>
                                    <option value="CVE">CVE - Cape Verdean Escudo</option>
                                    <option value="CZK">CZK - Czech Koruna</option>
                                    <option value="DJF">DJF - Djiboutian Franc</option>
                                    <option value="DKK">DKK - Danish Krone</option>
                                    <option value="DOP">DOP - Dominican Peso</option>
                                    <option value="DZD">DZD - Algerian Dinar</option>
                                    <option value="EGP">EGP - Egyptian Pound</option>
                                    <option value="ERN">ERN - Eritrean Nakfa</option>
                                    <option value="ETB">ETB - Ethiopian Birr</option>
                                    <option value="EUR">EUR - Euro</option>
                                    <option value="FJD">FJD - Fijian Dollar</option>
                                    <option value="FKP">FKP - Falkland Islands Pound</option>
                                    <option value="GBP">GBP - British Pound Sterling</option>
                                    <option value="GEL">GEL - Georgian Lari</option>
                                    <option value="GGP">GGP - Guernsey Pound</option>
                                    <option value="GHS">GHS - Ghanaian Cedi</option>
                                    <option value="GIP">GIP - Gibraltar Pound</option>
                                    <option value="GMD">GMD - Gambian Dalasi</option>
                                    <option value="GNF">GNF - Guinean Franc</option>
                                    <option value="GTQ">GTQ - Guatemalan Quetzal</option>
                                    <option value="GYD">GYD - Guyanaese Dollar</option>
                                    <option value="HKD">HKD - Hong Kong Dollar</option>
                                    <option value="HNL">HNL - Honduran Lempira</option>
                                    <option value="HRK">HRK - Croatian Kuna</option>
                                    <option value="HTG">HTG - Haitian Gourde</option>
                                    <option value="HUF">HUF - Hungarian Forint</option>
                                    <option value="IDR">IDR - Indonesian Rupiah</option>
                                    <option value="ILS">ILS - Israeli New Shekel</option>
                                    <option value="IMP">IMP - Manx Pound</option>
                                    <option value="INR">INR - Indian Rupee</option>
                                    <option value="IQD">IQD - Iraqi Dinar</option>
                                    <option value="IRR">IRR - Iranian Rial</option>
                                    <option value="ISK">ISK - Icelandic Kr√≥na</option>
                                    <option value="JEP">JEP - Jersey Pound</option>
                                    <option value="JMD">JMD - Jamaican Dollar</option>
                                    <option value="JOD">JOD - Jordanian Dinar</option>
                                    <option value="JPY">JPY - Japanese Yen</option>
                                    <option value="KES">KES - Kenyan Shilling</option>
                                    <option value="KGS">KGS - Kyrgystani Som</option>
                                    <option value="KHR">KHR - Cambodian Riel</option>
                                    <option value="KMF">KMF - Comorian Franc</option>
                                    <option value="KPW">KPW - North Korean Won</option>
                                    <option value="KRW">KRW - South Korean Won</option>
                                    <option value="KWD">KWD - Kuwaiti Dinar</option>
                                    <option value="KYD">KYD - Cayman Islands Dollar</option>
                                    <option value="KZT">KZT - Kazakhstani Tenge</option>
                                    <option value="LAK">LAK - Laotian Kip</option>
                                    <option value="LBP">LBP - Lebanese Pound</option>
                                    <option value="LKR">LKR - Sri Lankan Rupee</option>
                                    <option value="LRD">LRD - Liberian Dollar</option>
                                    <option value="LSL">LSL - Lesotho Loti</option>
                                    <option value="LYD">LYD - Libyan Dinar</option>
                                    <option value="MAD">MAD - Moroccan Dirham</option>
                                    <option value="MDL">MDL - Moldovan Leu</option>
                                    <option value="MGA">MGA - Malagasy Ariary</option>
                                    <option value="MKD">MKD - Macedonian Denar</option>
                                    <option value="MMK">MMK - Myanmar Kyat</option>
                                    <option value="MNT">MNT - Mongolian Tugrik</option>
                                    <option value="MOP">MOP - Macanese Pataca</option>
                                    <option value="MRU">MRU - Mauritanian Ouguiya</option>
                                    <option value="MUR">MUR - Mauritian Rupee</option>
                                    <option value="MVR">MVR - Maldivian Rufiyaa</option>
                                    <option value="MWK">MWK - Malawian Kwacha</option>
                                    <option value="MXN">MXN - Mexican Peso</option>
                                    <option value="MYR">MYR - Malaysian Ringgit</option>
                                    <option value="MZN">MZN - Mozambican Metical</option>
                                    <option value="NAD">NAD - Namibian Dollar</option>
                                    <option value="NGN">NGN - Nigerian Naira</option>
                                    <option value="NIO">NIO - Nicaraguan C√≥rdoba</option>
                                    <option value="NOK">NOK - Norwegian Krone</option>
                                    <option value="NPR">NPR - Nepalese Rupee</option>
                                    <option value="NZD">NZD - New Zealand Dollar</option>
                                    <option value="OMR">OMR - Omani Rial</option>
                                    <option value="PAB">PAB - Panamanian Balboa</option>
                                    <option value="PEN">PEN - Peruvian Nuevo Sol</option>
                                    <option value="PGK">PGK - Papua New Guinean Kina</option>
                                    <option value="PHP">PHP - Philippine Peso</option>
                                    <option value="PKR">PKR - Pakistani Rupee</option>
                                    <option value="PLN">PLN - Polish Zloty</option>
                                    <option value="PYG">PYG - Paraguayan Guarani</option>
                                    <option value="QAR">QAR - Qatari Rial</option>
                                    <option value="RON">RON - Romanian Leu</option>
                                    <option value="RSD">RSD - Serbian Dinar</option>
                                    <option value="RUB">RUB - Russian Ruble</option>
                                    <option value="RWF">RWF - Rwandan Franc</option>
                                    <option value="SAR">SAR - Saudi Riyal</option>
                                    <option value="SBD">SBD - Solomon Islands Dollar</option>
                                    <option value="SCR">SCR - Seychellois Rupee</option>
                                    <option value="SDG">SDG - Sudanese Pound</option>
                                    <option value="SEK">SEK - Swedish Krona</option>
                                    <option value="SGD">SGD - Singapore Dollar</option>
                                    <option value="SHP">SHP - Saint Helena Pound</option>
                                    <option value="SLL">SLL - Sierra Leonean Leone</option>
                                    <option value="SOS">SOS - Somali Shilling</option>
                                    <option value="SRD">SRD - Surinamese Dollar</option>
                                    <option value="SSP">SSP - South Sudanese Pound</option>
                                    <option value="STN">STN - S√£o Tom√© and Pr√≠ncipe Dobra</option>
                                    <option value="SYP">SYP - Syrian Pound</option>
                                    <option value="SZL">SZL - Swazi Lilangeni</option>
                                    <option value="THB">THB - Thai Baht</option>
                                    <option value="TJS">TJS - Tajikistani Somoni</option>
                                    <option value="TMT">TMT - Turkmenistani Manat</option>
                                    <option value="TND">TND - Tunisian Dinar</option>
                                    <option value="TOP">TOP - Tongan Pa ªanga</option>
                                    <option value="TRY">TRY - Turkish Lira</option>
                                    <option value="TTD">TTD - Trinidad and Tobago Dollar</option>
                                    <option value="TWD">TWD - New Taiwan Dollar</option>
                                    <option value="TZS">TZS - Tanzanian Shilling</option>
                                    <option value="UAH">UAH - Ukrainian Hryvnia</option>
                                    <option value="UGX">UGX - Ugandan Shilling</option>
                                    <option value="USD">USD - United States Dollar</option>
                                    <option value="UYU">UYU - Uruguayan Peso</option>
                                    <option value="UZS">UZS - Uzbekistan Som</option>
                                    <option value="VES">VES - Venezuelan Bol√≠var</option>
                                    <option value="VND">VND - Vietnamese Dong</option>
                                    <option value="VUV">VUV - Vanuatu Vatu</option>
                                    <option value="WST">WST - Samoan Tala</option>
                                    <option value="XAF">XAF - Central African CFA Franc</option>
                                    <option value="XCD">XCD - East Caribbean Dollar</option>
                                    <option value="XOF">XOF - West African CFA Franc</option>
                                    <option value="XPF">XPF - CFP Franc</option>
                                    <option value="YER">YER - Yemeni Rial</option>
                                    <option value="ZAR">ZAR - South African Rand</option>
                                    <option value="ZMW">ZMW - Zambian Kwacha</option>
                                    <option value="ZWL">ZWL - Zimbabwean Dollar</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label>Gross income in relation to The Relevant Activity <span class="required">*</span></label>
                                <input type="text" id="grossIncomeRelActivity" placeholder="Enter amount">
                            </div>
                        </div>
                        <div class="grid-2">
                            <div class="form-group">
                                <label>Net Book Value of tangible assets <span class="required">*</span></label>
                                <input type="text" id="netBookValue" placeholder="Enter value">
                            </div>
                            <div class="form-group">
                                <label>Type of Gross Income <span class="required">*</span></label>
                                <input type="text" id="typeGrossIncome" placeholder="Enter type">
                            </div>
                        </div>
                        <div class="form-group">
                            <label>Description of Assets</label>
                            <textarea id="descriptionAssets" rows="3" placeholder="Describe assets..." maxlength="500"></textarea>
                        </div>

                        <!-- Direction and Management Section -->
                        <div class="subsection-title" style="margin-top: 30px;">Direction and Management</div>
                        <div class="grid-2">
                            <div class="form-group">
                                <label>Directed and managed in the BVI <span class="required">*</span></label>
                                <div class="radio-group">
                                    <label class="radio-label">
                                        <input type="radio" name="directedBVI" value="YES">
                                        <span>YES</span>
                                    </label>
                                    <label class="radio-label">
                                        <input type="radio" name="directedBVI" value="NO">
                                        <span>NO</span>
                                    </label>
                                </div>
                            </div>
                            <div class="form-group">
                                <label>Minutes kept in the BVI <span class="required">*</span></label>
                                <div class="radio-group">
                                    <label class="radio-label">
                                        <input type="radio" name="minutesBVI" value="YES">
                                        <span>YES</span>
                                    </label>
                                    <label class="radio-label">
                                        <input type="radio" name="minutesBVI" value="NO">
                                        <span>NO</span>
                                    </label>
                                </div>
                            </div>
                        </div>
                        <div class="grid-2">
                            <div class="form-group">
                                <label>Number of Board Meetings <span class="required">*</span></label>
                                <input type="text" id="numBoardMeetings" placeholder="Enter number" maxlength="10">
                                <span class="error-message" id="error-numBoardMeetings"></span>
                            </div>
                            <div class="form-group">
                                <label>Board Meetings in the BVI <span class="required">*</span></label>
                                <input type="text" id="boardMeetingsBVI" placeholder="Enter number" maxlength="10">
                                <span class="error-message" id="error-boardMeetingsBVI"></span>
                            </div>
                        </div>
                        <div class="grid-2">
                            <div class="form-group">
                                <label>Quorum of Board Meetings <span class="required">*</span></label>
                                <input type="text" id="quorumBoardMeetings" placeholder="Enter quorum">
                            </div>
                            <div class="form-group">
                                <label>Quorum of Directors Physically Present in the Virgin Islands <span class="required">*</span></label>
                                <div class="radio-group">
                                    <label class="radio-label">
                                        <input type="radio" name="quorumPhysicallyPresent" value="YES">
                                        <span>YES</span>
                                    </label>
                                    <label class="radio-label">
                                        <input type="radio" name="quorumPhysicallyPresent" value="NO">
                                        <span>NO</span>
                                    </label>
                                </div>
                            </div>
                        </div>

                        <!-- Meetings Section -->
                        <div class="subsection-title" style="margin-top: 30px;">Meetings</div>
                        <div class="info-box">
                            <strong>Note:</strong> Attach evidence of Director Qualification(s) to the email submitting the completed declaration to Bethel Worldwide Corporation.
                        </div>
                        <div id="meetingsContainer"></div>
                        <button type="button" class="btn btn-primary" onclick="addMeeting()">+ Add Another Meeting</button>

                        <!-- Premises Section -->
                        <div class="subsection-title" style="margin-top: 30px;">Premises</div>
                        <div id="premisesContainer"></div>
                        <button type="button" class="btn btn-primary" onclick="addPremises()">+ Add Another Premises</button>

                        <!-- Expenditure Section -->
                        <div class="subsection-title" style="margin-top: 30px;">Expenditure</div>
                        <div class="grid-3">
                            <div class="form-group">
                                <label>Reporting Currency <span class="required">*</span></label>
                                <select id="expenditureReportingCurrency">
                                    <option value="">Select Currency</option>
                                    <option value="AED">AED - United Arab Emirates Dirham</option>
                                    <option value="AFN">AFN - Afghan Afghani</option>
                                    <option value="ALL">ALL - Albanian Lek</option>
                                    <option value="AMD">AMD - Armenian Dram</option>
                                    <option value="ANG">ANG - Netherlands Antillean Guilder</option>
                                    <option value="AOA">AOA - Angolan Kwanza</option>
                                    <option value="ARS">ARS - Argentine Peso</option>
                                    <option value="AUD">AUD - Australian Dollar</option>
                                    <option value="AWG">AWG - Aruban Florin</option>
                                    <option value="AZN">AZN - Azerbaijani Manat</option>
                                    <option value="BAM">BAM - Bosnia-Herzegovina Convertible Mark</option>
                                    <option value="BBD">BBD - Barbadian Dollar</option>
                                    <option value="BDT">BDT - Bangladeshi Taka</option>
                                    <option value="BGN">BGN - Bulgarian Lev</option>
                                    <option value="BHD">BHD - Bahraini Dinar</option>
                                    <option value="BIF">BIF - Burundian Franc</option>
                                    <option value="BMD">BMD - Bermudan Dollar</option>
                                    <option value="BND">BND - Brunei Dollar</option>
                                    <option value="BOB">BOB - Bolivian Boliviano</option>
                                    <option value="BRL">BRL - Brazilian Real</option>
                                    <option value="BSD">BSD - Bahamian Dollar</option>
                                    <option value="BTN">BTN - Bhutanese Ngultrum</option>
                                    <option value="BWP">BWP - Botswanan Pula</option>
                                    <option value="BYN">BYN - Belarusian Ruble</option>
                                    <option value="BZD">BZD - Belize Dollar</option>
                                    <option value="CAD">CAD - Canadian Dollar</option>
                                    <option value="CDF">CDF - Congolese Franc</option>
                                    <option value="CHF">CHF - Swiss Franc</option>
                                    <option value="CLP">CLP - Chilean Peso</option>
                                    <option value="CNY">CNY - Chinese Yuan</option>
                                    <option value="COP">COP - Colombian Peso</option>
                                    <option value="CRC">CRC - Costa Rican Col√≥n</option>
                                    <option value="CUP">CUP - Cuban Peso</option>
                                    <option value="CVE">CVE - Cape Verdean Escudo</option>
                                    <option value="CZK">CZK - Czech Koruna</option>
                                    <option value="DJF">DJF - Djiboutian Franc</option>
                                    <option value="DKK">DKK - Danish Krone</option>
                                    <option value="DOP">DOP - Dominican Peso</option>
                                    <option value="DZD">DZD - Algerian Dinar</option>
                                    <option value="EGP">EGP - Egyptian Pound</option>
                                    <option value="ERN">ERN - Eritrean Nakfa</option>
                                    <option value="ETB">ETB - Ethiopian Birr</option>
                                    <option value="EUR">EUR - Euro</option>
                                    <option value="FJD">FJD - Fijian Dollar</option>
                                    <option value="FKP">FKP - Falkland Islands Pound</option>
                                    <option value="GBP">GBP - British Pound Sterling</option>
                                    <option value="GEL">GEL - Georgian Lari</option>
                                    <option value="GGP">GGP - Guernsey Pound</option>
                                    <option value="GHS">GHS - Ghanaian Cedi</option>
                                    <option value="GIP">GIP - Gibraltar Pound</option>
                                    <option value="GMD">GMD - Gambian Dalasi</option>
                                    <option value="GNF">GNF - Guinean Franc</option>
                                    <option value="GTQ">GTQ - Guatemalan Quetzal</option>
                                    <option value="GYD">GYD - Guyanaese Dollar</option>
                                    <option value="HKD">HKD - Hong Kong Dollar</option>
                                    <option value="HNL">HNL - Honduran Lempira</option>
                                    <option value="HRK">HRK - Croatian Kuna</option>
                                    <option value="HTG">HTG - Haitian Gourde</option>
                                    <option value="HUF">HUF - Hungarian Forint</option>
                                    <option value="IDR">IDR - Indonesian Rupiah</option>
                                    <option value="ILS">ILS - Israeli New Shekel</option>
                                    <option value="IMP">IMP - Manx Pound</option>
                                    <option value="INR">INR - Indian Rupee</option>
                                    <option value="IQD">IQD - Iraqi Dinar</option>
                                    <option value="IRR">IRR - Iranian Rial</option>
                                    <option value="ISK">ISK - Icelandic Kr√≥na</option>
                                    <option value="JEP">JEP - Jersey Pound</option>
                                    <option value="JMD">JMD - Jamaican Dollar</option>
                                    <option value="JOD">JOD - Jordanian Dinar</option>
                                    <option value="JPY">JPY - Japanese Yen</option>
                                    <option value="KES">KES - Kenyan Shilling</option>
                                    <option value="KGS">KGS - Kyrgystani Som</option>
                                    <option value="KHR">KHR - Cambodian Riel</option>
                                    <option value="KMF">KMF - Comorian Franc</option>
                                    <option value="KPW">KPW - North Korean Won</option>
                                    <option value="KRW">KRW - South Korean Won</option>
                                    <option value="KWD">KWD - Kuwaiti Dinar</option>
                                    <option value="KYD">KYD - Cayman Islands Dollar</option>
                                    <option value="KZT">KZT - Kazakhstani Tenge</option>
                                    <option value="LAK">LAK - Laotian Kip</option>
                                    <option value="LBP">LBP - Lebanese Pound</option>
                                    <option value="LKR">LKR - Sri Lankan Rupee</option>
                                    <option value="LRD">LRD - Liberian Dollar</option>
                                    <option value="LSL">LSL - Lesotho Loti</option>
                                    <option value="LYD">LYD - Libyan Dinar</option>
                                    <option value="MAD">MAD - Moroccan Dirham</option>
                                    <option value="MDL">MDL - Moldovan Leu</option>
                                    <option value="MGA">MGA - Malagasy Ariary</option>
                                    <option value="MKD">MKD - Macedonian Denar</option>
                                    <option value="MMK">MMK - Myanmar Kyat</option>
                                    <option value="MNT">MNT - Mongolian Tugrik</option>
                                    <option value="MOP">MOP - Macanese Pataca</option>
                                    <option value="MRU">MRU - Mauritanian Ouguiya</option>
                                    <option value="MUR">MUR - Mauritian Rupee</option>
                                    <option value="MVR">MVR - Maldivian Rufiyaa</option>
                                    <option value="MWK">MWK - Malawian Kwacha</option>
                                    <option value="MXN">MXN - Mexican Peso</option>
                                    <option value="MYR">MYR - Malaysian Ringgit</option>
                                    <option value="MZN">MZN - Mozambican Metical</option>
                                    <option value="NAD">NAD - Namibian Dollar</option>
                                    <option value="NGN">NGN - Nigerian Naira</option>
                                    <option value="NIO">NIO - Nicaraguan C√≥rdoba</option>
                                    <option value="NOK">NOK - Norwegian Krone</option>
                                    <option value="NPR">NPR - Nepalese Rupee</option>
                                    <option value="NZD">NZD - New Zealand Dollar</option>
                                    <option value="OMR">OMR - Omani Rial</option>
                                    <option value="PAB">PAB - Panamanian Balboa</option>
                                    <option value="PEN">PEN - Peruvian Nuevo Sol</option>
                                    <option value="PGK">PGK - Papua New Guinean Kina</option>
                                    <option value="PHP">PHP - Philippine Peso</option>
                                    <option value="PKR">PKR - Pakistani Rupee</option>
                                    <option value="PLN">PLN - Polish Zloty</option>
                                    <option value="PYG">PYG - Paraguayan Guarani</option>
                                    <option value="QAR">QAR - Qatari Rial</option>
                                    <option value="RON">RON - Romanian Leu</option>
                                    <option value="RSD">RSD - Serbian Dinar</option>
                                    <option value="RUB">RUB - Russian Ruble</option>
                                    <option value="RWF">RWF - Rwandan Franc</option>
                                    <option value="SAR">SAR - Saudi Riyal</option>
                                    <option value="SBD">SBD - Solomon Islands Dollar</option>
                                    <option value="SCR">SCR - Seychellois Rupee</option>
                                    <option value="SDG">SDG - Sudanese Pound</option>
                                    <option value="SEK">SEK - Swedish Krona</option>
                                    <option value="SGD">SGD - Singapore Dollar</option>
                                    <option value="SHP">SHP - Saint Helena Pound</option>
                                    <option value="SLL">SLL - Sierra Leonean Leone</option>
                                    <option value="SOS">SOS - Somali Shilling</option>
                                    <option value="SRD">SRD - Surinamese Dollar</option>
                                    <option value="SSP">SSP - South Sudanese Pound</option>
                                    <option value="STN">STN - S√£o Tom√© and Pr√≠ncipe Dobra</option>
                                    <option value="SYP">SYP - Syrian Pound</option>
                                    <option value="SZL">SZL - Swazi Lilangeni</option>
                                    <option value="THB">THB - Thai Baht</option>
                                    <option value="TJS">TJS - Tajikistani Somoni</option>
                                    <option value="TMT">TMT - Turkmenistani Manat</option>
                                    <option value="TND">TND - Tunisian Dinar</option>
                                    <option value="TOP">TOP - Tongan Pa ªanga</option>
                                    <option value="TRY">TRY - Turkish Lira</option>
                                    <option value="TTD">TTD - Trinidad and Tobago Dollar</option>
                                    <option value="TWD">TWD - New Taiwan Dollar</option>
                                    <option value="TZS">TZS - Tanzanian Shilling</option>
                                    <option value="UAH">UAH - Ukrainian Hryvnia</option>
                                    <option value="UGX">UGX - Ugandan Shilling</option>
                                    <option value="USD">USD - United States Dollar</option>
                                    <option value="UYU">UYU - Uruguayan Peso</option>
                                    <option value="UZS">UZS - Uzbekistan Som</option>
                                    <option value="VES">VES - Venezuelan Bol√≠var</option>
                                    <option value="VND">VND - Vietnamese Dong</option>
                                    <option value="VUV">VUV - Vanuatu Vatu</option>
                                    <option value="WST">WST - Samoan Tala</option>
                                    <option value="XAF">XAF - Central African CFA Franc</option>
                                    <option value="XCD">XCD - East Caribbean Dollar</option>
                                    <option value="XOF">XOF - West African CFA Franc</option>
                                    <option value="XPF">XPF - CFP Franc</option>
                                    <option value="YER">YER - Yemeni Rial</option>
                                    <option value="ZAR">ZAR - South African Rand</option>
                                    <option value="ZMW">ZMW - Zambian Kwacha</option>
                                    <option value="ZWL">ZWL - Zimbabwean Dollar</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label>Total Expenditure <span class="required">*</span></label>
                                <input type="text" id="totalExpenditure" placeholder="Enter amount">
                            </div>
                            <div class="form-group">
                                <label>BVI Expenditure <span class="required">*</span></label>
                                <input type="text" id="bviExpenditure" placeholder="Enter amount">
                            </div>
                        </div>

                        <!-- Employees Section -->
                        <div class="subsection-title" style="margin-top: 30px;">Employees</div>
                        <div class="grid-3">
                            <div class="form-group">
                                <label>Total Employees <span class="required">*</span></label>
                                <input type="text" id="totalEmployees" placeholder="Enter number" maxlength="10">
                                <span class="error-message" id="error-totalEmployees"></span>
                            </div>
                            <div class="form-group">
                                <label>BVI Employees <span class="required">*</span></label>
                                <input type="text" id="bviEmployees" placeholder="Enter number" maxlength="10">
                                <span class="error-message" id="error-bviEmployees"></span>
                            </div>
                            <div class="form-group">
                                <label>Employees engaged in activity <span class="required">*</span></label>
                                <input type="text" id="employeesEngaged" placeholder="Enter number" maxlength="10">
                                <span class="error-message" id="error-employeesEngaged"></span>
                            </div>
                        </div>

                        <div class="subsection-title">BVI Employee Details</div>
                        <div class="info-box">
                            <strong>Note:</strong> Attach evidence of Employees' Qualification(s) to the email submitting the completed declaration to Bethel Worldwide Corporation.
                        </div>
                        <div id="bviEmployeesContainer"></div>
                        <button type="button" class="btn btn-primary" onclick="addBVIEmployee()">+ Add Another BVI Employee</button>

                        <!-- High Risk IP Legal Entity Section -->
                        <div class="subsection-title" style="margin-top: 30px;">High Risk IP Legal Entity</div>
                        <div class="form-group">
                            <label>Is the entity a High Risk intellectual property (IP) entity <span class="required">*</span></label>
                            <div class="radio-group">
                                <label class="radio-label">
                                    <input type="radio" name="highRiskIP" value="YES" onchange="toggleHighRiskIPFields()">
                                    <span>YES</span>
                                </label>
                                <label class="radio-label">
                                    <input type="radio" name="highRiskIP" value="NO" onchange="toggleHighRiskIPFields()">
                                    <span>NO</span>
                                </label>
                            </div>
                        </div>

                        <div id="highRiskIPFields" style="display: none;">
                            <div class="form-group">
                                <label>Does the legal entity conduct CIGA other than those outlined in Section 7(h) of the ESA? <span class="required">*</span></label>
                                <div class="radio-group">
                                    <label class="radio-label">
                                        <input type="radio" name="conductCIGA" value="YES">
                                        <span>YES</span>
                                    </label>
                                    <label class="radio-label">
                                        <input type="radio" name="conductCIGA" value="NO">
                                        <span>NO</span>
                                    </label>
                                </div>
                            </div>
                            <div class="form-group">
                                <label>Identify the relevant IP asset which it holds <span class="required">*</span></label>
                                <input type="text" id="relevantIPAsset" placeholder="Identify IP asset">
                            </div>
                        </div>

                        <!-- Outsourcing Section -->
                        <div class="subsection-title" style="margin-top: 30px;">Outsourcing</div>
                        <div class="form-group">
                            <label>CIGA Outsourced <span class="required">*</span></label>
                            <div class="radio-group">
                                <label class="radio-label">
                                    <input type="radio" name="cigaOutsourced" value="YES" onchange="toggleOutsourcingFields()">
                                    <span>YES</span>
                                </label>
                                <label class="radio-label">
                                    <input type="radio" name="cigaOutsourced" value="NO" onchange="toggleOutsourcingFields()">
                                    <span>NO</span>
                                </label>
                            </div>
                        </div>

                        <div id="outsourcingFields" style="display: none;">
                            <div class="grid-2">
                                <div class="form-group">
                                    <label>Reporting currency <span class="required">*</span></label>
                                    <select id="outsourcingReportingCurrency">
                                        <option value="">Select Currency</option>
                                        <option value="USD">USD</option>
                                        <option value="EUR">EUR</option>
                                        <option value="GBP">GBP</option>
                                        <option value="CAD">CAD</option>
                                        <option value="AUD">AUD</option>
                                        <option value="CHF">CHF</option>
                                        <option value="JPY">JPY</option>
                                    </select>
                                </div>
                                <div class="form-group">
                                    <label>Outsourcing Expenditure <span class="required">*</span></label>
                                    <input type="text" id="outsourcingExpenditure" placeholder="Enter amount" maxlength="50">
                                </div>
                            </div>
                            <div class="form-group">
                                <label>Equipment <span class="required">*</span></label>
                                <input type="text" id="equipment" placeholder="Describe equipment" maxlength="300">
                            </div>
                        </div>

                        <!-- CIGA Section -->
                        <div class="subsection-title" style="margin-top: 30px;">CIGA</div>
                        <div id="cigaContainer"></div>
                        <button type="button" class="btn btn-primary" onclick="addCIGA()">+ Add Another CIGA</button>

                    </div>

                    <!-- Supporting Comments (always visible) -->
                    <div class="form-group" style="margin-top: 30px;">
                        <label>Supporting Comments</label>
                        <textarea id="supportingComments" rows="4" placeholder="Please provide any supporting comments..." maxlength="2000"></textarea>
                    </div>

                    <!-- Supporting Documents -->
                    <div class="subsection-title" style="margin-top: 30px;">Supporting Documents</div>
                    <div class="info-box" style="background-color:#fff9e6;border-color:#f59e0b;">
                        <p style="margin:0;"><strong>Note:</strong> Any Supporting Documents should be listed here and attached to email containing this "Declaration" and being sent to Bethel Worldwide Corporation as the company's Registered Agent.</p>
                    </div>
                    <div id="supportingDocumentsContainer"></div>
                    <button type="button" class="btn btn-primary" onclick="addSupportingDocument()">+ Add Another File Reference</button>
                </div>

                <!-- Supporting Documents and Remarks -->
                <div class="section">
                    <div class="info-box" style="background-color:#fff9e6;border-color:#f59e0b;">
                        <p style="margin:0;"><strong>üìé Supporting Documents:</strong> Please attach any supporting documents to your email sharing the completed form with Bethel Worldwide Corporation.</p>
                    </div>

                    <div class="form-group">
                        <label>Remarks</label>
                        <textarea id="remarks" rows="4" placeholder="Enter any additional remarks..." maxlength="1000"></textarea>
                    </div>

                    <div class="info-box" style="background-color:#fef3c7;border-color:#fbbf24;margin-top:10px;">
                        <p style="margin:0;"><strong>Note:</strong> These comments will have no legal implications and will not form any part of the Entity's profile.</p>
                    </div>
                </div>

                <!-- Required Attachments Confirmation -->
                <div class="section">
                    <div class="info-box" style="background-color:#fff4e6;border-color:#fb923c;border-width:3px;">
                        <p style="margin:0 0 10px 0;font-size:16px;"><strong>‚ö†Ô∏è IMPORTANT - Required Attachments</strong></p>
                        <p style="margin:0 0 8px 0;">Before signing this declaration, please confirm that you have attached the following documents to the email when submitting this completed form to Bethel Worldwide Corporation:</p>
                        <ul style="margin:8px 0 0 20px;padding:0;">
                            <li style="margin-bottom:6px;"><strong>Evidence of Director Qualification(s)</strong> - Documentation supporting the qualifications of directors involved in the relevant activities</li>
                            <li style="margin-bottom:0;"><strong>Evidence of Employees' Qualification(s)</strong> - Documentation supporting the qualifications of BVI employees listed in this declaration</li>
                        </ul>
                    </div>
                </div>

                <!-- E-Signature Section -->
                <div class="section">
                    <h3 class="section-title">Authorized Signature</h3>
                    
                    <div class="info-box" style="background-color:#dbeafe;border-color:#60a5fa;">
                        <p style="margin:0;"><strong>Electronic Signature Notice:</strong> By providing your electronic signature below, you acknowledge and agree that your electronic signature is the legally binding equivalent of your handwritten signature. Electronic signatures have the same legal force and effect as handwritten signatures under applicable law, including the British Virgin Islands Electronic Transactions Act and international electronic signature regulations. This declaration will be deemed executed and delivered when you electronically sign and submit this form.</p>
                    </div>
                    
                    <div class="form-group">
                        <label>Signatory Name <span class="required">*</span></label>
                        <input type="text" id="signatoryName" placeholder="Enter full name of person signing" maxlength="200">
                        <span class="error-message" id="error-signatoryName"></span>
                    </div>

                    <div class="grid-2">
                        <div class="form-group">
                            <label>Title/Position <span class="required">*</span></label>
                            <input type="text" id="signatoryTitle" placeholder="Enter title or position" maxlength="150">
                            <span class="error-message" id="error-signatoryTitle"></span>
                        </div>
                        <div class="form-group">
                            <label>Date <span class="required">*</span></label>
                            <input type="date" id="signatureDate">
                            <span class="error-message" id="error-signatureDate"></span>
                        </div>
                    </div>

                    <div class="form-group">
                        <label>Signature <span class="required">*</span></label>
                        <div style="border: 2px solid #d1d5db; border-radius: 6px; background: white; padding: 10px;">
                            <canvas id="signatureCanvas" width="900" height="200" style="border: 1px dashed #9ca3af; cursor: crosshair; display: block; width: 100%; max-width: 900px;"></canvas>
                        </div>
                        <div style="margin-top: 10px; display: flex; gap: 10px;">
                            <button type="button" class="btn btn-secondary" onclick="clearSignature()">Clear Signature</button>
                            <span style="color: #6b7280; font-size: 14px; margin-left: 10px; line-height: 40px;">Draw your signature above using your mouse or touchscreen</span>
                        </div>
                        <span class="error-message" id="error-signature"></span>
                    </div>
                </div>

                <!-- Submit Button -->
                <div class="submit-section">
                    <button type="button" class="btn-submit" onclick="generatePDF()">Generate PDF</button>
                    <button type="button" class="btn-secondary" onclick="resetForm()" style="margin-left: 15px;">Reset Form</button>
                    <p class="submit-note">Click to generate a PDF of this declaration</p>
                </div>
            </form>
        </div>

        <!-- Loading Spinner -->
        <div id="loadingSpinner" style="display: none;">
            <div class="spinner-overlay">
                <div class="spinner-content">
                    <div class="spinner"></div>
                    <p class="spinner-text">Generating PDF...</p>
                </div>
            </div>
        </div>

        <!-- Floating Save Button -->
        <button type="button" class="floating-save-btn" onclick="saveFormProgress()" title="Save your progress">
            <span class="save-icon">üíæ</span>
            <span>Save Progress</span>
        </button>

        <!-- Footer -->
        <div class="footer">
            <p><strong>Bethel Worldwide Corporation</strong></p>
            <p>Bethel House, P.O. Box 4749, Road Town, Tortola, VG1110, British Virgin Islands</p>
            <p>For assistance, please contact your Bethel Worldwide Corporation representative</p>
        </div>
    </div>

    <script>
        // Initialize arrays
        const beneficialOwners = [];
        const relevantActivities = [];
        const meetings = [];
        const premises = [];
        const bviEmployees = [];
        const cigas = [];
        const supportingDocuments = [];

        // Country list with UK Overseas Territories added alphabetically
       const countries = ["Afghanistan","Aland Islands","Albania","Algeria","American Samoa","Andorra","Angola","Anguilla","Antarctica","Antigua and Barbuda","Argentina","Armenia","Aruba","Ashmore and Cartier Islands","At Sea","Australia","Austria","Azerbaijan","Bahamas","Bahrain","Bangladesh","Barbados","Belarus","Belgium","Belize","Bermuda","Benin","Bhutan","Bolivia","Bosnia and Herzegovina","Botswana","Bouvet Island","Brazil","British Indian Ocean Territiry","British Virgin Islands","Brunei","Bulgaria","Burkina Faso","Burundi","Cabo Verde","Cambodia","Cameroon","Canada","Cape Verde","Caribbean Netherlands","Cayman Islands","Central African Republic","Chad","Chile","China","Colombia","Comoros","Congo","Costa Rica","Christmas Island","Clipperton Island","Cocos (Keeling) Islands","Comoros","Cook Islands","Croatia","Cuba","Curacao","Cyprus","Czech Republic","Denmark","Djibouti","Dominica","Dominican Republic","East Timor","Ecuador","Egypt","El Salvador","Equatorial Guinea","Eritrea","Estonia","Eswatini","Ethiopia","Falkland Islands","Fiji","Finland","France","French Guiana","French Polynesia","French Southern and Antarctic Lands","French Southern Territories","Gabon","Gambia","Georgia","Germany","Ghana","Gibraltar","Greece","Greenland","Grenada","Guadeloupe","Guam","Guatemala","Guernsey","Guinea","Guinea-Bissau","Guyana","Haiti","Heard Island and McDonald Islands","Honduras","Hong Kong","Hungary","Iceland","India","Indonesia","Isle of Man","Iran","Iraq","Ireland","Israel","Italy","Ivory Coast","Jamaica","Japan","Jersey","Jordan","Kazakhstan","Kenya","Kiribati","Kosovo","Kuwait","Kyrgyzstan","Laos","Latvia","Lebanon","Lesotho","Liberia","Libya","Liechtenstein","Lithuania","Luxembourg","Macao","Macedonia","Madagascar","Malawi","Malaysia","Maldives","Mali","Malta","Marshall Islands","Martinique","Mauritania","Mauritius","Mayotte","Mexico","Micronesia","Moldova","Monaco","Mongolia","Montenegro","Montserrat","Morocco","Mozambique","Myanmar","Namibia","Nauru","Nepal","Netherlands","Netherlands Antilles","New Caledonia","New Zealand","Nicaragua","Niger","Nigeria","Niue","Norfolk Island","North Korea","North Macedonia","Northern Mariana Islands","Norway","Oman","Pakistan","Palau","Palestine","Palestinian Territory (Occupied)","Panama","Papua New Guinea","Paraguay","Peru","Philippines","Pitcairn","Poland","Portugal","Puerto Rico","Qatar","Reunion","Romania","Russia","Rwanda","Saint Barthelemy","Saint Helena","Saint Kitts and Nevis","Saint Lucia","Saint Martin (French)","Saint Pierre and Miquelon","Saint Vincent and the Grenadines","Samoa","San Marino","Sao Tome and Principe","Saudi Arabia","Senegal","Serbia","Seychelles","Sierra Leone","Singapore","Sint Maarten (Dutch)","Slovakia","Slovenia","Solomon Islands","Somalia","South Africa","South Korea","South Georgia and the South Sandwich Islands","South Sudan","Spain","Sri Lanka","Sudan","Suriname","Svalbard and Jan Mayen Islands","Swaziland","Sweden","Switzerland","Syria","Taiwan","Tajikistan","Tanzania","Thailand","Tibet","Timor Leste","Togo","Tokelau","Tonga","Trinidad and Tobago","Tunisia","Turkey","Turks and Caicos Islands","Turkmenistan","Tuvalu","Uganda","Ukraine","United Arab Emirates","United Kingdom","United States","Uruguay","US Virgin Islands","Uzbekistan","Vanuatu","Vatican City","Venezuela","Vietnam","Wallis and Futuna","Western Sahara","Yemen","Yugoslavia","Zambia","Zimbabwe"];

        // Populate country dropdowns
        function populateCountryDropdown(selectElement) {
            countries.forEach(country => {
                const option = document.createElement('option');
                option.value = country;
                option.textContent = country;
                selectElement.appendChild(option);
            });
        }

        // Initialize country dropdowns on page load
        document.addEventListener('DOMContentLoaded', function() {
            populateCountryDropdown(document.getElementById('businessCountry'));
            populateCountryDropdown(document.getElementById('tinCountry'));
            populateCountryDropdown(document.getElementById('otherIdCountry'));
            
            // Ensure all radio buttons are unchecked and add first beneficial owner
            document.querySelectorAll('input[type="radio"]').forEach(radio => {
                radio.checked = false;
            });
            addBeneficialOwner();
            
            // Check if there's saved progress and notify user
            const saved = localStorage.getItem('esDeclarationForm');
            if (saved) {
                const formData = JSON.parse(saved);
                document.getElementById('lastSavedTime').textContent = 'Last saved: ' + new Date(formData.timestamp).toLocaleString();
                document.getElementById('saveStatus').innerHTML = '<strong>Note:</strong> You have saved progress from a previous session. Click "Load Saved Data" below if you wish to restore it.';
                document.getElementById('saveStatus').style.color = '#0369a1';
            }
        });

        // Toggle business address fields
        function toggleBusinessAddress() {
            const sameAddress = document.querySelector('input[name="sameAddress"]:checked');
            const businessFields = document.getElementById('businessAddressFields');
            
            if (sameAddress && sameAddress.value === 'no') {
                businessFields.style.display = 'block';
            } else {
                businessFields.style.display = 'none';
            }
        }

        // Add beneficial owner
        function addBeneficialOwner() {
            const index = beneficialOwners.length;
            beneficialOwners.push({});
            const container = document.getElementById('beneficialOwnersContainer');
            const div = document.createElement('div');
            div.className = 'person-block';
            div.innerHTML = `
                <div class="person-header">
                    <div class="person-title">Beneficial Owner ${index + 1}</div>
                    ${index > 0 ? `<button type="button" class="btn btn-danger" onclick="removeBeneficialOwner(${index})">Remove</button>` : ''}
                </div>
                <div class="grid-2">
                    <div class="form-group">
                        <label>First Name <span class="required">*</span></label>
                        <input type="text" data-bo="${index}" data-field="firstName" placeholder="Enter first name" maxlength="100">
                    </div>
                    <div class="form-group">
                        <label>Last Name <span class="required">*</span></label>
                        <input type="text" data-bo="${index}" data-field="lastName" placeholder="Enter last name" maxlength="100">
                    </div>
                </div>
                <div class="form-group">
                    <label>Date of Birth <span class="required">*</span></label>
                    <input type="date" data-bo="${index}" data-field="dob">
                </div>
                <div class="form-group">
                    <label>BO Type <span class="required">*</span></label>
                    <select data-bo="${index}" data-field="boType">
                        <option value="">Select Type</option>
                        <option value="Legal Arrangement ‚Äì Other ‚Äì Beneficiary ‚Äì Equivalent">Legal Arrangement ‚Äì Other ‚Äì Beneficiary ‚Äì Equivalent</option>
                        <option value="Legal Arrangement ‚Äì Other ‚Äì Other ‚Äì Equivalent">Legal Arrangement ‚Äì Other ‚Äì Other ‚Äì Equivalent</option>
                        <option value="Legal Arrangement ‚Äì Other ‚Äì Protector ‚Äì Equivalent">Legal Arrangement ‚Äì Other ‚Äì Protector ‚Äì Equivalent</option>
                        <option value="Legal Arrangement ‚Äì Other ‚Äì Settlor ‚Äì Equivalent">Legal Arrangement ‚Äì Other ‚Äì Settlor ‚Äì Equivalent</option>
                        <option value="Legal Arrangement ‚Äì Other ‚Äì Trustee ‚Äì Equivalent">Legal Arrangement ‚Äì Other ‚Äì Trustee ‚Äì Equivalent</option>
                        <option value="Legal Arrangement ‚Äì Trust ‚Äì Beneficiary">Legal Arrangement ‚Äì Trust ‚Äì Beneficiary</option>
                        <option value="Legal Arrangement ‚Äì Trust ‚Äì Protector">Legal Arrangement ‚Äì Trust ‚Äì Protector</option>
                        <option value="Legal Arrangement ‚Äì Trust ‚Äì Trustee">Legal Arrangement ‚Äì Trust ‚Äì Trustee</option>
                        <option value="Legal Arrangement ‚Äì Trust ‚Äì Settlor">Legal Arrangement ‚Äì Trust ‚Äì Settlor</option>
                        <option value="Legal Person ‚Äì Other Means">Legal Person ‚Äì Other Means</option>
                        <option value="Legal Person ‚Äì Ownership">Legal Person ‚Äì Ownership</option>
                        <option value="Legal Person ‚Äì Senior Managing Official">Legal Person ‚Äì Senior Managing Official</option>
                    </select>
                </div>
                <div class="grid-2">
                    <div class="form-group">
                        <label>Start Date <span class="required">*</span></label>
                        <input type="date" data-bo="${index}" data-field="startDate">
                    </div>
                    <div class="form-group">
                        <label>End Date (If Applicable)</label>
                        <input type="date" data-bo="${index}" data-field="endDate">
                    </div>
                </div>
                <div class="grid-2">
                    <div class="form-group">
                        <label>Taxpayer Identification No.</label>
                        <input type="text" data-bo="${index}" data-field="taxId" placeholder="Enter tax ID" maxlength="50">
                    </div>
                    <div class="form-group">
                        <label>Issued By</label>
                        <select data-bo="${index}" data-field="taxIdCountry">
                            <option value="">Select Country</option>
                        </select>
                    </div>
                </div>
                <div class="subsection-title">Address</div>
                <div class="form-group">
                    <label>Address <span class="required">*</span></label>
                    <input type="text" data-bo="${index}" data-field="address" placeholder="Address line 1" maxlength="200">
                </div>
                <div class="form-group">
                    <label>Street</label>
                    <input type="text" data-bo="${index}" data-field="street" placeholder="Street" maxlength="150">
                </div>
                <div class="grid-2">
                    <div class="form-group">
                        <label>City <span class="required">*</span></label>
                        <input type="text" data-bo="${index}" data-field="city" placeholder="City" maxlength="100">
                    </div>
                    <div class="form-group">
                        <label>State/Province</label>
                        <input type="text" data-bo="${index}" data-field="state" placeholder="State/Province" maxlength="100">
                    </div>
                </div>
                <div class="grid-2">
                    <div class="form-group">
                        <label>Postal Code</label>
                        <input type="text" data-bo="${index}" data-field="postal" placeholder="Postal Code" maxlength="20">
                    </div>
                    <div class="form-group">
                        <label>Country <span class="required">*</span></label>
                        <select data-bo="${index}" data-field="country">
                            <option value="">Select Country</option>
                        </select>
                    </div>
                </div>
                <div class="form-group">
                    <label>Jurisdiction of Tax Residence <span class="required">*</span></label>
                    <select data-bo="${index}" data-field="taxResidence">
                        <option value="">Select Country</option>
                    </select>
                </div>
            `;
            container.appendChild(div);
            
            // Populate country dropdowns for this BO
            const taxIdCountrySelect = div.querySelector(`select[data-bo="${index}"][data-field="taxIdCountry"]`);
            const countrySelect = div.querySelector(`select[data-bo="${index}"][data-field="country"]`);
            const taxResidenceSelect = div.querySelector(`select[data-bo="${index}"][data-field="taxResidence"]`);
            
            populateCountryDropdown(taxIdCountrySelect);
            populateCountryDropdown(countrySelect);
            populateCountryDropdown(taxResidenceSelect);
        }

        // Remove beneficial owner
        function removeBeneficialOwner(index) {
            if (confirm('Are you sure you want to remove this beneficial owner? This action cannot be undone.')) {
                // Find the person-block that contains inputs with this specific data-bo index
                const container = document.getElementById('beneficialOwnersContainer');
                const blocks = container.querySelectorAll('.person-block');
                
                blocks.forEach(block => {
                    const firstInput = block.querySelector(`[data-bo="${index}"]`);
                    if (firstInput) {
                        block.remove();
                    }
                });
                
                beneficialOwners[index] = null;
            }
        }

        // Economic Substance Declaration Functions

        // Toggle Declaration Type fields
        function toggleDeclarationFields() {
            const declarationType = document.getElementById('declarationType').value;
            const relevantActivityFields = document.getElementById('relevantActivityFields');
            
            if (declarationType === '1') {
                relevantActivityFields.style.display = 'block';
                // Add first relevant activity by default if none exist
                if (relevantActivities.length === 0) {
                    addRelevantActivity();
                }
                if (meetings.length === 0) {
                    addMeeting();
                }
                if (premises.length === 0) {
                    addPremises();
                }
                if (bviEmployees.length === 0) {
                    addBVIEmployee();
                }
                if (cigas.length === 0) {
                    addCIGA();
                }
                if (supportingDocuments.length === 0) {
                    addSupportingDocument();
                }
            } else {
                relevantActivityFields.style.display = 'none';
            }
        }

        // Add Relevant Activity
        function addRelevantActivity() {
            const index = relevantActivities.length;
            relevantActivities.push({});
            const container = document.getElementById('relevantActivitiesContainer');
            const div = document.createElement('div');
            div.className = 'person-block';
            div.innerHTML = `
                <div class="person-header">
                    <div class="person-title">Relevant Activity ${index + 1}</div>
                    ${index > 0 ? `<button type="button" class="btn btn-danger" onclick="removeRelevantActivity(${index})">Remove</button>` : ''}
                </div>
                <div class="grid-2">
                    <div class="form-group">
                        <label>Relevant Activity Name <span class="required">*</span></label>
                        <select data-ra="${index}" data-field="activityName" onchange="toggleHoldingBusinessFields(${index})">
                            <option value="">Select Relevant Activity</option>
                            <option value="1">1 ‚Äì Banking Business</option>
                            <option value="2">2 ‚Äì Distribution and Service Centre Business</option>
                            <option value="3">3 ‚Äì Finance and Leasing Business</option>
                            <option value="4">4 ‚Äì Fund Management Business</option>
                            <option value="5">5 ‚Äì Headquarters Business</option>
                            <option value="6">6 ‚Äì Holding Business</option>
                            <option value="7">7 ‚Äì Insurance Business</option>
                            <option value="8">8 ‚Äì Intellectual Property Business</option>
                            <option value="9">9 ‚Äì Shipping Business</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Carried on for only part of the Financial Period</label>
                        <div class="radio-group">
                            <label class="radio-label">
                                <input type="radio" name="partialPeriod_${index}" value="YES" onchange="toggleActivityDates(${index})">
                                <span>YES</span>
                            </label>
                            <label class="radio-label">
                                <input type="radio" name="partialPeriod_${index}" value="NO" onchange="toggleActivityDates(${index})">
                                <span>NO</span>
                            </label>
                        </div>
                    </div>
                </div>
                <div id="activityDates_${index}" style="display: none;">
                    <div class="grid-2">
                        <div class="form-group">
                            <label>Activity Start Date</label>
                            <input type="date" data-ra="${index}" data-field="startDate">
                        </div>
                        <div class="form-group">
                            <label>Activity End Date</label>
                            <input type="date" data-ra="${index}" data-field="endDate">
                        </div>
                    </div>
                </div>
                <div id="holdingBusinessFields_${index}" style="display: none;">
                    <div class="subsection-title">Pure Equity Holding Entity</div>
                    <div class="form-group">
                        <label>Does the entity actively manage its equity participation? <span class="required">*</span></label>
                        <div class="radio-group">
                            <label class="radio-label">
                                <input type="radio" name="activelyManage_${index}" value="YES">
                                <span>YES</span>
                            </label>
                            <label class="radio-label">
                                <input type="radio" name="activelyManage_${index}" value="NO">
                                <span>NO</span>
                            </label>
                        </div>
                    </div>
                    <div class="form-group">
                        <label>Does the entity comply with its statutory obligations under the BVI Business Companies Act, 2004 or the Limited Partnership Act, 2017 (whichever is relevant)? <span class="required">*</span></label>
                        <div class="radio-group">
                            <label class="radio-label">
                                <input type="radio" name="statutoryCompliance_${index}" value="YES">
                                <span>YES</span>
                            </label>
                            <label class="radio-label">
                                <input type="radio" name="statutoryCompliance_${index}" value="NO">
                                <span>NO</span>
                            </label>
                        </div>
                    </div>
                </div>
            `;
            container.appendChild(div);
        }

        function removeRelevantActivity(index) {
            relevantActivities[index] = null;
            document.querySelector(`[data-ra="${index}"]`)?.closest('.person-block')?.remove();
        }

        function toggleActivityDates(index) {
            const selected = document.querySelector(`input[name="partialPeriod_${index}"]:checked`)?.value;
            const datesDiv = document.getElementById(`activityDates_${index}`);
            datesDiv.style.display = selected === 'YES' ? 'block' : 'none';
        }

        function toggleHoldingBusinessFields(index) {
            const activitySelect = document.querySelector(`select[data-ra="${index}"][data-field="activityName"]`);
            const holdingFields = document.getElementById(`holdingBusinessFields_${index}`);
            holdingFields.style.display = activitySelect.value === '6' ? 'block' : 'none';
        }

        // Add Meeting
        function addMeeting() {
            const index = meetings.length;
            meetings.push({});
            const container = document.getElementById('meetingsContainer');
            const div = document.createElement('div');
            div.className = 'person-block';
            div.innerHTML = `
                <div class="person-header">
                    <div class="person-title">Meeting ${index + 1}</div>
                    ${index > 0 ? `<button type="button" class="btn btn-danger" onclick="removeMeeting(${index})">Remove</button>` : ''}
                </div>
                <div class="grid-2">
                    <div class="form-group">
                        <label>Meeting No <span class="required">*</span></label>
                        <input type="text" data-meeting="${index}" data-field="meetingNo" placeholder="Enter meeting number">
                    </div>
                    <div class="form-group">
                        <label>Person's Name <span class="required">*</span></label>
                        <input type="text" data-meeting="${index}" data-field="personName" placeholder="Enter person's name">
                    </div>
                </div>
                <div class="grid-2">
                    <div class="form-group">
                        <label>Relation to Company <span class="required">*</span></label>
                        <input type="text" data-meeting="${index}" data-field="relation" placeholder="Enter relation">
                    </div>
                    <div class="form-group">
                        <label>Director Qualification <span class="required">*</span></label>
                        <input type="text" data-meeting="${index}" data-field="qualification" placeholder="Enter qualification">
                    </div>
                </div>
                <div class="form-group">
                    <label>Physically Present <span class="required">*</span></label>
                    <div class="radio-group">
                        <label class="radio-label">
                            <input type="radio" name="physicallyPresent_${index}" value="YES">
                            <span>YES</span>
                        </label>
                        <label class="radio-label">
                            <input type="radio" name="physicallyPresent_${index}" value="NO">
                            <span>NO</span>
                        </label>
                    </div>
                </div>
            `;
            container.appendChild(div);
        }

        function removeMeeting(index) {
            meetings[index] = null;
            document.querySelector(`[data-meeting="${index}"]`)?.closest('.person-block')?.remove();
        }

        // Add Premises
        function addPremises() {
            const index = premises.length;
            premises.push({});
            const container = document.getElementById('premisesContainer');
            const div = document.createElement('div');
            div.className = 'person-block';
            div.innerHTML = `
                <div class="person-header">
                    <div class="person-title">Premises ${index + 1}</div>
                    ${index > 0 ? `<button type="button" class="btn btn-danger" onclick="removePremises(${index})">Remove</button>` : ''}
                </div>
                <div class="form-group">
                    <label>Address Line 1 <span class="required">*</span></label>
                    <input type="text" data-premises="${index}" data-field="address1" placeholder="Enter address line 1">
                </div>
                <div class="form-group">
                    <label>Address Line 2</label>
                    <input type="text" data-premises="${index}" data-field="address2" placeholder="Enter address line 2">
                </div>
                <div class="form-group">
                    <label>Country <span class="required">*</span></label>
                    <select data-premises="${index}" data-field="country">
                        <option value="">Select Country</option>
                    </select>
                </div>
            `;
            container.appendChild(div);
            // Populate country dropdown for this premises
            const countrySelect = div.querySelector('select');
            populateCountryDropdown(countrySelect);
        }

        function removePremises(index) {
            premises[index] = null;
            document.querySelector(`[data-premises="${index}"]`)?.closest('.person-block')?.remove();
        }

        // Add BVI Employee
        function addBVIEmployee() {
            const index = bviEmployees.length;
            bviEmployees.push({});
            const container = document.getElementById('bviEmployeesContainer');
            const div = document.createElement('div');
            div.className = 'person-block';
            div.innerHTML = `
                <div class="person-header">
                    <div class="person-title">BVI Employee ${index + 1}</div>
                    ${index > 0 ? `<button type="button" class="btn btn-danger" onclick="removeBVIEmployee(${index})">Remove</button>` : ''}
                </div>
                <div class="grid-3">
                    <div class="form-group">
                        <label>Employee Name <span class="required">*</span></label>
                        <input type="text" data-bviemp="${index}" data-field="empName" placeholder="Enter employee name" maxlength="150">
                    </div>
                    <div class="form-group">
                        <label>Employee Qualification <span class="required">*</span></label>
                        <input type="text" data-bviemp="${index}" data-field="empQual" placeholder="Enter qualification" maxlength="200">
                    </div>
                    <div class="form-group">
                        <label>Years of Relevant Experience <span class="required">*</span></label>
                        <input type="text" data-bviemp="${index}" data-field="empExp" placeholder="Enter years" maxlength="10">
                    </div>
                </div>
            `;
            container.appendChild(div);
        }

        function removeBVIEmployee(index) {
            bviEmployees[index] = null;
            document.querySelector(`[data-bviemp="${index}"]`)?.closest('.person-block')?.remove();
        }

        // Toggle High Risk IP fields
        function toggleHighRiskIPFields() {
            const selected = document.querySelector('input[name="highRiskIP"]:checked')?.value;
            const fields = document.getElementById('highRiskIPFields');
            fields.style.display = selected === 'YES' ? 'block' : 'none';
        }

        // Toggle Outsourcing fields
        function toggleOutsourcingFields() {
            const selected = document.querySelector('input[name="cigaOutsourced"]:checked')?.value;
            const fields = document.getElementById('outsourcingFields');
            fields.style.display = selected === 'YES' ? 'block' : 'none';
        }

        // Add CIGA
        function addCIGA() {
            const index = cigas.length;
            cigas.push({});
            const container = document.getElementById('cigaContainer');
            const div = document.createElement('div');
            div.className = 'person-block';
            div.innerHTML = `
                <div class="person-header">
                    <div class="person-title">CIGA ${index + 1}</div>
                    ${index > 0 ? `<button type="button" class="btn btn-danger" onclick="removeCIGA(${index})">Remove</button>` : ''}
                </div>
                <div class="grid-2">
                    <div class="form-group">
                        <label>CIGA Code</label>
                        <select data-ciga="${index}" data-field="cigaCode">
                            <option value="">Select CIGA Code</option>
                            <option value="CIGA1">CIGA1 ‚Äì Research and Development</option>
                            <option value="CIGA2">CIGA2 ‚Äì Branding</option>
                            <option value="CIGA3">CIGA3 ‚Äì Marketing</option>
                            <option value="CIGA4">CIGA4 ‚Äì Distribution</option>
                            <option value="CIGA5">CIGA5 ‚Äì Strategic Decision Making</option>
                            <option value="CIGA6">CIGA6 ‚Äì Assumption/Management of Risk</option>
                            <option value="CIGA7">CIGA7 ‚Äì Other Activity</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>CIGA Description</label>
                        <input type="text" data-ciga="${index}" data-field="cigaDesc" placeholder="Enter description">
                    </div>
                </div>
                <div class="form-group">
                    <label>CIGA Other Text</label>
                    <input type="text" data-ciga="${index}" data-field="cigaOther" placeholder="Enter other text if applicable">
                </div>
            `;
            container.appendChild(div);
        }

        function removeCIGA(index) {
            cigas[index] = null;
            document.querySelector(`[data-ciga="${index}"]`)?.closest('.person-block')?.remove();
        }

        // Add Supporting Document
        function addSupportingDocument() {
            const index = supportingDocuments.length;
            supportingDocuments.push({});
            const container = document.getElementById('supportingDocumentsContainer');
            const div = document.createElement('div');
            div.className = 'person-block';
            div.innerHTML = `
                <div class="person-header">
                    <div class="person-title">File Reference ${index + 1}</div>
                    ${index > 0 ? `<button type="button" class="btn btn-danger" onclick="removeSupportingDocument(${index})">Remove</button>` : ''}
                </div>
                <div class="form-group">
                    <label>File Name</label>
                    <input type="text" data-file="${index}" data-field="fileName" placeholder="Enter file name">
                </div>
            `;
            container.appendChild(div);
        }

        function removeSupportingDocument(index) {
            supportingDocuments[index] = null;
            document.querySelector(`[data-file="${index}"]`)?.closest('.person-block')?.remove();
        }

        // End Economic Substance Declaration Functions

        // Save form progress
        function saveFormProgress() {
            try {
                const formData = {
                    timestamp: new Date().toISOString(),
                    simpleFields: {},
                    dynamicCounts: {
                        beneficialOwners: beneficialOwners.length
                    },
                    boFields: {}
                };

                // Save all simple input fields
                document.querySelectorAll('input[type="text"], input[type="date"], textarea, select').forEach(el => {
                    if (el.id) {
                        formData.simpleFields[el.id] = el.value;
                    }
                    
                    // Save BO fields with data attributes
                    const boIndex = el.getAttribute('data-bo');
                    const boField = el.getAttribute('data-field');
                    if (boIndex !== null && boField) {
                        const key = `bo${boIndex}_${boField}`;
                        formData.boFields[key] = el.value;
                    }
                });

                // Save radio button selections
                document.querySelectorAll('input[type="radio"]:checked').forEach(el => {
                    formData.simpleFields[el.name + '_radio'] = el.value;
                });

                // Save to localStorage
                localStorage.setItem('esDeclarationForm', JSON.stringify(formData));

                // Update UI
                const now = new Date();
                document.getElementById('lastSavedTime').textContent = 'Last saved: ' + now.toLocaleString();
                document.getElementById('saveStatus').textContent = '‚úì Progress saved successfully!';
                document.getElementById('saveStatus').style.color = '#047857';

                setTimeout(() => {
                    document.getElementById('saveStatus').textContent = 'Your progress is automatically saved every 30 seconds. You can also save manually.';
                    document.getElementById('saveStatus').style.color = '#075985';
                }, 3000);
            } catch (e) {
                alert('Error saving progress: ' + e.message);
            }
        }

        // Load form progress
        function loadFormProgress() {
            try {
                const saved = localStorage.getItem('esDeclarationForm');
                if (!saved) {
                    alert('No saved progress found. Please fill out the form and click "Save Now" to save your progress.');
                    return false;
                }

                const formData = JSON.parse(saved);

                // Restore simple fields
                for (const [id, value] of Object.entries(formData.simpleFields)) {
                    if (id.endsWith('_radio')) {
                        // Restore radio button
                        const radioName = id.replace('_radio', '');
                        const radios = document.querySelectorAll(`input[name="${radioName}"]`);
                        radios.forEach(radio => {
                            if (radio.value === value) {
                                radio.checked = true;
                                // Trigger change event for business address toggle
                                if (radioName === 'sameAddress') {
                                    toggleBusinessAddress();
                                }
                            }
                        });
                    } else {
                        const el = document.getElementById(id);
                        if (el) el.value = value;
                    }
                }

                // Restore BOs
                if (formData.dynamicCounts.beneficialOwners > 0) {
                    for (let i = 0; i < formData.dynamicCounts.beneficialOwners; i++) {
                        addBeneficialOwner();
                    }

                    // Restore BO fields
                    for (const [key, value] of Object.entries(formData.boFields)) {
                        const match = key.match(/bo(\d+)_(.+)/);
                        if (match) {
                            const boIndex = match[1];
                            const fieldName = match[2];
                            const el = document.querySelector(`[data-bo="${boIndex}"][data-field="${fieldName}"]`);
                            if (el) el.value = value;
                        }
                    }
                }

                document.getElementById('lastSavedTime').textContent = 'Last saved: ' + new Date(formData.timestamp).toLocaleString();
                document.getElementById('saveStatus').textContent = '‚úì Saved progress loaded successfully!';
                document.getElementById('saveStatus').style.color = '#047857';
                
                setTimeout(() => {
                    document.getElementById('saveStatus').textContent = 'Your progress is automatically saved every 30 seconds. You can also save manually.';
                    document.getElementById('saveStatus').style.color = '#075985';
                }, 3000);
                
                return true;
            } catch (e) {
                console.error('Error loading progress:', e);
                return false;
            }
        }

        // Clear saved progress
        function clearSavedProgress() {
            if (confirm('Are you sure you want to clear all saved progress? This cannot be undone.')) {
                localStorage.removeItem('esDeclarationForm');
                document.getElementById('lastSavedTime').textContent = '';
                document.getElementById('saveStatus').textContent = 'Saved data cleared. Form will be reset on next page load.';
                document.getElementById('saveStatus').style.color = '#dc2626';
            }
        }

        // E-Signature Canvas Functionality
        let canvas = null;
        let ctx = null;
        let isDrawing = false;
        let hasSignature = false;

        // Initialize signature canvas when DOM is loaded
        window.addEventListener('load', function() {
            canvas = document.getElementById('signatureCanvas');
            ctx = canvas.getContext('2d');
            
            // Set canvas actual size (for better resolution)
            canvas.width = 900;
            canvas.height = 200;
            
            ctx.strokeStyle = '#000000';
            ctx.lineWidth = 2;
            ctx.lineCap = 'round';
            ctx.lineJoin = 'round';

            // Mouse events
            canvas.addEventListener('mousedown', startDrawing);
            canvas.addEventListener('mousemove', draw);
            canvas.addEventListener('mouseup', stopDrawing);
            canvas.addEventListener('mouseout', stopDrawing);

            // Touch events for mobile
            canvas.addEventListener('touchstart', handleTouchStart);
            canvas.addEventListener('touchmove', handleTouchMove);
            canvas.addEventListener('touchend', stopDrawing);
        });

        function startDrawing(e) {
            isDrawing = true;
            const rect = canvas.getBoundingClientRect();
            const scaleX = canvas.width / rect.width;
            const scaleY = canvas.height / rect.height;
            ctx.beginPath();
            ctx.moveTo((e.clientX - rect.left) * scaleX, (e.clientY - rect.top) * scaleY);
        }

        function draw(e) {
            if (!isDrawing) return;
            const rect = canvas.getBoundingClientRect();
            const scaleX = canvas.width / rect.width;
            const scaleY = canvas.height / rect.height;
            ctx.lineTo((e.clientX - rect.left) * scaleX, (e.clientY - rect.top) * scaleY);
            ctx.stroke();
            hasSignature = true;
        }

        function stopDrawing() {
            isDrawing = false;
        }

        function handleTouchStart(e) {
            e.preventDefault();
            const touch = e.touches[0];
            const mouseEvent = new MouseEvent('mousedown', {
                clientX: touch.clientX,
                clientY: touch.clientY
            });
            canvas.dispatchEvent(mouseEvent);
        }

        function handleTouchMove(e) {
            e.preventDefault();
            const touch = e.touches[0];
            const mouseEvent = new MouseEvent('mousemove', {
                clientX: touch.clientX,
                clientY: touch.clientY
            });
            canvas.dispatchEvent(mouseEvent);
        }

        function clearSignature() {
            if (confirm('Are you sure you want to clear the signature?')) {
                ctx.clearRect(0, 0, canvas.width, canvas.height);
                hasSignature = false;
            }
        }

        function getSignatureImage() {
            return canvas.toDataURL('image/png');
        }

        // Auto-save every 30 seconds
        setInterval(saveFormProgress, 30000);

        // Track if form has changes
        let formHasChanges = false;
        
        // Mark form as changed when any input is modified
        document.addEventListener('input', function() {
            formHasChanges = true;
        });
        
        document.addEventListener('change', function() {
            formHasChanges = true;
        });
        
        // Warn user before leaving if there are unsaved changes
        window.addEventListener('beforeunload', function(e) {
            if (formHasChanges) {
                // Save one more time before leaving
                saveFormProgress();
                
                // Modern browsers ignore custom messages, but we still need to return a value
                e.preventDefault();
                e.returnValue = '';
                return '';
            }
        });
        
        // Reset the formHasChanges flag after saving
        const originalSaveFormProgress = saveFormProgress;
        saveFormProgress = function() {
            originalSaveFormProgress();
            formHasChanges = false;
        };

        // Reset Form
        function resetForm() {
            if (confirm('Are you sure you want to reset the form? All data will be lost.')) {
                // Clear all text inputs
                document.querySelectorAll('input[type="text"], input[type="date"], textarea').forEach(input => {
                    input.value = '';
                    input.classList.remove('error');
                });
                
                // Reset all select dropdowns to first option
                document.querySelectorAll('select').forEach(select => {
                    select.selectedIndex = 0;
                    select.classList.remove('error');
                });
                
                // Uncheck all radio buttons
                document.querySelectorAll('input[type="radio"]').forEach(radio => {
                    radio.checked = false;
                });
                
                // Clear all error messages
                document.querySelectorAll('.error-message').forEach(error => {
                    error.textContent = '';
                });
                
                // Reset beneficial owners
                const container = document.getElementById('beneficialOwnersContainer');
                container.innerHTML = '';
                beneficialOwners.length = 0;
                addBeneficialOwner();
                
                // Clear signature
                if (canvas && ctx) {
                    ctx.clearRect(0, 0, canvas.width, canvas.height);
                    hasSignature = false;
                }
                
                // Clear localStorage
                localStorage.removeItem('formProgress');
                
                // Scroll to top
                window.scrollTo({ top: 0, behavior: 'smooth' });
                
                // Show confirmation
                alert('Form has been reset successfully.');
            }
        }

        // Generate PDF
        function generatePDF() {
            // Validation
            const required = ['periodStartDate', 'periodEndDate', 'entityName', 'entityNumber', 'incorporationDate', 'declarationType', 'entityActivities'];
            let valid = true;

            required.forEach(id => {
                const el = document.getElementById(id);
                const errorEl = document.getElementById('error-' + id);
                if (el && !el.value) {
                    if (el) el.classList.add('error');
                    if (errorEl) errorEl.textContent = 'This field is required';
                    valid = false;
                } else {
                    if (el) el.classList.remove('error');
                    if (errorEl) errorEl.textContent = '';
                }
            });

            // Validate required radio button groups
            const requiredRadioGroups = [
                { name: 'sameAddress', label: 'Is Business Address same as Registered Office Address?' },
                { name: 'mneGroup', label: 'Is the entity part of a MNE Group?' },
                { name: 'ultimateParent', label: 'Does the entity have an ultimate parent entity?' },
                { name: 'immediateParent', label: 'Does the entity have an immediate parent entity?' }
            ];

            requiredRadioGroups.forEach(group => {
                const checked = document.querySelector(`input[name="${group.name}"]:checked`);
                if (!checked) {
                    alert(`Please answer: ${group.label}`);
                    valid = false;
                }
            });

            // Validate business address if "No" is selected
            const sameAddress = document.querySelector('input[name="sameAddress"]:checked');
            if (sameAddress && sameAddress.value === 'no') {
                ['businessAddress', 'businessCity', 'businessCountry'].forEach(id => {
                    const el = document.getElementById(id);
                    const errorEl = document.getElementById('error-' + id);
                    if (el && !el.value) {
                        if (el) el.classList.add('error');
                        if (errorEl) errorEl.textContent = 'This field is required';
                        valid = false;
                    } else {
                        if (el) el.classList.remove('error');
                        if (errorEl) errorEl.textContent = '';
                    }
                });
            }

            // Validate at least one BO with required fields
            let hasValidBO = false;
            beneficialOwners.forEach((bo, idx) => {
                if (bo !== null) {
                    const firstName = document.querySelector(`input[data-bo="${idx}"][data-field="firstName"]`)?.value;
                    const lastName = document.querySelector(`input[data-bo="${idx}"][data-field="lastName"]`)?.value;
                    const dob = document.querySelector(`input[data-bo="${idx}"][data-field="dob"]`)?.value;
                    const boType = document.querySelector(`select[data-bo="${idx}"][data-field="boType"]`)?.value;
                    const startDate = document.querySelector(`input[data-bo="${idx}"][data-field="startDate"]`)?.value;
                    const address = document.querySelector(`input[data-bo="${idx}"][data-field="address"]`)?.value;
                    const city = document.querySelector(`input[data-bo="${idx}"][data-field="city"]`)?.value;
                    const country = document.querySelector(`select[data-bo="${idx}"][data-field="country"]`)?.value;
                    const taxResidence = document.querySelector(`select[data-bo="${idx}"][data-field="taxResidence"]`)?.value;

                    if (firstName && lastName && dob && boType && startDate && address && city && country && taxResidence) {
                        hasValidBO = true;
                    }
                }
            });

            if (!hasValidBO) {
                alert('Please complete at least one beneficial owner with all required fields (First Name, Last Name, Date of Birth, BO Type, Start Date, Address, City, Country, and Tax Residence).');
                valid = false;
            }

            // Validate signature fields
            const signatoryName = document.getElementById('signatoryName');
            const signatoryTitle = document.getElementById('signatoryTitle');
            const signatureDate = document.getElementById('signatureDate');

            if (!signatoryName.value.trim()) {
                signatoryName.classList.add('error');
                document.getElementById('error-signatoryName').textContent = 'Signatory name is required';
                valid = false;
            } else {
                signatoryName.classList.remove('error');
                document.getElementById('error-signatoryName').textContent = '';
            }

            if (!signatoryTitle.value.trim()) {
                signatoryTitle.classList.add('error');
                document.getElementById('error-signatoryTitle').textContent = 'Title/Position is required';
                valid = false;
            } else {
                signatoryTitle.classList.remove('error');
                document.getElementById('error-signatoryTitle').textContent = '';
            }

            if (!signatureDate.value) {
                signatureDate.classList.add('error');
                document.getElementById('error-signatureDate').textContent = 'Signature date is required';
                valid = false;
            } else {
                signatureDate.classList.remove('error');
                document.getElementById('error-signatureDate').textContent = '';
            }

            if (!hasSignature) {
                document.getElementById('error-signature').textContent = 'Please provide your signature';
                alert('Please sign the declaration by drawing your signature in the signature box.');
                valid = false;
            } else {
                document.getElementById('error-signature').textContent = '';
            }

            if (!valid) {
                alert('Please complete all required fields marked with *');
                return;
            }

            // Show loading spinner
            document.getElementById('loadingSpinner').style.display = 'block';

            // Use setTimeout to allow the spinner to render before heavy processing
            setTimeout(() => {
                try {
                    // Check if jsPDF is loaded
                    if (typeof window.jspdf === 'undefined') {
                        alert('PDF library failed to load. Please refresh the page and try again.');
                        document.getElementById('loadingSpinner').style.display = 'none';
                        return;
                    }
                    
                    // Initialize jsPDF
                    const { jsPDF } = window.jspdf;
                    const doc = new jsPDF();
            
            const pageWidth = doc.internal.pageSize.getWidth();
            const pageHeight = doc.internal.pageSize.getHeight();
            const margin = 15;
            let yPosition = margin;

            // Helper function to add text with wrapping and page breaks
            function addText(text, x, y, maxWidth) {
                const lines = doc.splitTextToSize(text, maxWidth);
                lines.forEach(line => {
                    if (y > pageHeight - 20) {
                        doc.addPage();
                        y = margin;
                    }
                    doc.text(line, x, y);
                    y += 6;
                });
                return y;
            }

            // Header
            doc.setFillColor(45, 89, 134);
            doc.rect(0, 0, pageWidth, 35, 'F');
            doc.setTextColor(255, 255, 255);
            doc.setFontSize(18);
            doc.setFont(undefined, 'bold');
            doc.text('BETHEL WORLDWIDE CORPORATION', pageWidth / 2, 12, { align: 'center' });
            doc.setFontSize(14);
            doc.text('Economic Substance Declaration', pageWidth / 2, 20, { align: 'center' });
            
            doc.setTextColor(0, 0, 0);
            yPosition = 40;

            // Financial Period
            doc.setFontSize(11);
            doc.setFont(undefined, 'bold');
            yPosition = addText('FINANCIAL PERIOD', margin, yPosition, pageWidth - 2 * margin);
            yPosition += 5;
            doc.setFontSize(10);
            doc.setFont(undefined, 'normal');
            yPosition = addText(`Start Date: ${document.getElementById('periodStartDate').value}`, margin, yPosition, pageWidth - 2 * margin);
            yPosition = addText(`End Date: ${document.getElementById('periodEndDate').value}`, margin, yPosition, pageWidth - 2 * margin);
            yPosition += 8;

            // Entity Information
            doc.setFontSize(11);
            doc.setFont(undefined, 'bold');
            yPosition = addText('ENTITY INFORMATION', margin, yPosition, pageWidth - 2 * margin);
            yPosition += 5;
            doc.setFontSize(10);
            doc.setFont(undefined, 'normal');
            yPosition = addText(`Entity Name: ${document.getElementById('entityName').value}`, margin, yPosition, pageWidth - 2 * margin);
            yPosition = addText(`Entity Number: ${document.getElementById('entityNumber').value}`, margin, yPosition, pageWidth - 2 * margin);
            yPosition = addText(`Entity Status: Active`, margin, yPosition, pageWidth - 2 * margin);
            yPosition = addText(`Entity Type: ${document.getElementById('entityType').value}`, margin, yPosition, pageWidth - 2 * margin);
            yPosition = addText(`Date of Incorporation / Registration: ${document.getElementById('incorporationDate').value}`, margin, yPosition, pageWidth - 2 * margin);
            yPosition += 5;
            yPosition = addText('Registered Office Address:', margin, yPosition, pageWidth - 2 * margin);
            yPosition = addText('Bethel House, P.O. Box 4749, Road Town, Tortola, VG1110, British Virgin Islands', margin + 5, yPosition, pageWidth - 2 * margin - 5);
            yPosition += 5;

            // Business Address
            const sameAddressRadio = document.querySelector('input[name="sameAddress"]:checked');
            if (sameAddressRadio && sameAddressRadio.value === 'no') {
                yPosition = addText('Business Address:', margin, yPosition, pageWidth - 2 * margin);
                let businessAddr = document.getElementById('businessAddress').value;
                if (document.getElementById('businessStreet').value) businessAddr += ', ' + document.getElementById('businessStreet').value;
                if (document.getElementById('businessCity').value) businessAddr += ', ' + document.getElementById('businessCity').value;
                if (document.getElementById('businessState').value) businessAddr += ', ' + document.getElementById('businessState').value;
                if (document.getElementById('businessPostal').value) businessAddr += ', ' + document.getElementById('businessPostal').value;
                businessAddr += ', ' + document.getElementById('businessCountry').value;
                yPosition = addText(businessAddr, margin + 5, yPosition, pageWidth - 2 * margin - 5);
                yPosition += 5;
            } else {
                yPosition = addText('Business Address: Same as Registered Office Address', margin, yPosition, pageWidth - 2 * margin);
                yPosition += 5;
            }

            if (document.getElementById('tin').value) {
                yPosition = addText(`TIN: ${document.getElementById('tin').value} (Issued by: ${document.getElementById('tinCountry').value || 'N/A'})`, margin, yPosition, pageWidth - 2 * margin);
            }
            if (document.getElementById('otherIdNo').value) {
                yPosition = addText(`Other ID: ${document.getElementById('otherIdNo').value} (Type: ${document.getElementById('otherIdType').value || 'N/A'}, Issued by: ${document.getElementById('otherIdCountry').value || 'N/A'})`, margin, yPosition, pageWidth - 2 * margin);
            }
            yPosition += 5;

            const mneGroup = document.querySelector('input[name="mneGroup"]:checked');
            if (mneGroup) yPosition = addText(`Part of MNE Group: ${mneGroup.value.toUpperCase()}`, margin, yPosition, pageWidth - 2 * margin);
            
            const ultimateParent = document.querySelector('input[name="ultimateParent"]:checked');
            if (ultimateParent) yPosition = addText(`Has Ultimate Parent Entity: ${ultimateParent.value.toUpperCase()}`, margin, yPosition, pageWidth - 2 * margin);
            
            const immediateParent = document.querySelector('input[name="immediateParent"]:checked');
            if (immediateParent) yPosition = addText(`Has Immediate Parent Entity: ${immediateParent.value.toUpperCase()}`, margin, yPosition, pageWidth - 2 * margin);
            
            yPosition += 8;

            // Agent Details
            doc.setFontSize(11);
            doc.setFont(undefined, 'bold');
            yPosition = addText('AGENT DETAILS', margin, yPosition, pageWidth - 2 * margin);
            yPosition += 5;
            doc.setFontSize(10);
            doc.setFont(undefined, 'normal');
            yPosition = addText('Agent Name: Bethel Worldwide Corporation', margin, yPosition, pageWidth - 2 * margin);
            yPosition = addText('Agent Address: Bethel House, P.O. Box 4749, Road Town, Tortola, VG1110, British Virgin Islands', margin, yPosition, pageWidth - 2 * margin);
            yPosition += 8;

            // Beneficial Owners
            doc.setFontSize(11);
            doc.setFont(undefined, 'bold');
            yPosition = addText('BENEFICIAL OWNERS', margin, yPosition, pageWidth - 2 * margin);
            yPosition += 5;
            doc.setFontSize(10);
            doc.setFont(undefined, 'normal');

            beneficialOwners.forEach((bo, idx) => {
                if (bo !== null) {
                    const firstName = document.querySelector(`input[data-bo="${idx}"][data-field="firstName"]`)?.value || '';
                    const lastName = document.querySelector(`input[data-bo="${idx}"][data-field="lastName"]`)?.value || '';
                    const dob = document.querySelector(`input[data-bo="${idx}"][data-field="dob"]`)?.value || '';
                    const boType = document.querySelector(`select[data-bo="${idx}"][data-field="boType"]`)?.value || '';
                    const startDate = document.querySelector(`input[data-bo="${idx}"][data-field="startDate"]`)?.value || '';
                    const endDate = document.querySelector(`input[data-bo="${idx}"][data-field="endDate"]`)?.value || '';
                    const taxId = document.querySelector(`input[data-bo="${idx}"][data-field="taxId"]`)?.value || '';
                    const taxIdCountry = document.querySelector(`select[data-bo="${idx}"][data-field="taxIdCountry"]`)?.value || '';
                    const address = document.querySelector(`input[data-bo="${idx}"][data-field="address"]`)?.value || '';
                    const street = document.querySelector(`input[data-bo="${idx}"][data-field="street"]`)?.value || '';
                    const city = document.querySelector(`input[data-bo="${idx}"][data-field="city"]`)?.value || '';
                    const state = document.querySelector(`input[data-bo="${idx}"][data-field="state"]`)?.value || '';
                    const postal = document.querySelector(`input[data-bo="${idx}"][data-field="postal"]`)?.value || '';
                    const country = document.querySelector(`select[data-bo="${idx}"][data-field="country"]`)?.value || '';
                    const taxResidence = document.querySelector(`select[data-bo="${idx}"][data-field="taxResidence"]`)?.value || '';

                    if (firstName && lastName) {
                        if (yPosition > pageHeight - 60) {
                            doc.addPage();
                            yPosition = margin;
                        }

                        doc.setFont(undefined, 'bold');
                        yPosition = addText(`Beneficial Owner ${idx + 1}:`, margin, yPosition, pageWidth - 2 * margin);
                        yPosition += 3;
                        doc.setFont(undefined, 'normal');
                        yPosition = addText(`Name: ${firstName} ${lastName}`, margin + 5, yPosition, pageWidth - 2 * margin - 5);
                        yPosition = addText(`Date of Birth: ${dob}`, margin + 5, yPosition, pageWidth - 2 * margin - 5);
                        yPosition = addText(`BO Type: ${boType}`, margin + 5, yPosition, pageWidth - 2 * margin - 5);
                        yPosition = addText(`Start Date: ${startDate}`, margin + 5, yPosition, pageWidth - 2 * margin - 5);
                        if (endDate) yPosition = addText(`End Date: ${endDate}`, margin + 5, yPosition, pageWidth - 2 * margin - 5);
                        if (taxId) yPosition = addText(`Tax ID: ${taxId} (Issued by: ${taxIdCountry})`, margin + 5, yPosition, pageWidth - 2 * margin - 5);
                        
                        let boAddress = address;
                        if (street) boAddress += ', ' + street;
                        if (city) boAddress += ', ' + city;
                        if (state) boAddress += ', ' + state;
                        if (postal) boAddress += ', ' + postal;
                        boAddress += ', ' + country;
                        yPosition = addText(`Address: ${boAddress}`, margin + 5, yPosition, pageWidth - 2 * margin - 5);
                        yPosition = addText(`Tax Residence: ${taxResidence}`, margin + 5, yPosition, pageWidth - 2 * margin - 5);
                        yPosition += 5;
                    }
                }
            });

            // Economic Substance Declaration
            if (yPosition > pageHeight - 60) {
                doc.addPage();
                yPosition = margin;
            }
            yPosition += 3;
            doc.setFontSize(11);
            doc.setFont(undefined, 'bold');
            yPosition = addText('ECONOMIC SUBSTANCE DECLARATION', margin, yPosition, pageWidth - 2 * margin);
            yPosition += 5;
            doc.setFontSize(10);
            doc.setFont(undefined, 'normal');
            
            const declarationType = document.getElementById('declarationType').value;
            yPosition = addText(`Declaration Type: ${declarationType}`, margin, yPosition, pageWidth - 2 * margin);
            yPosition += 5;
            
            const entityActivities = document.getElementById('entityActivities').value;
            yPosition = addText('Description of Activities:', margin, yPosition, pageWidth - 2 * margin);
            yPosition = addText(entityActivities, margin + 5, yPosition, pageWidth - 2 * margin - 5);
            yPosition += 5;
            
            const supportingComments = document.getElementById('supportingComments').value;
            if (supportingComments) {
                yPosition = addText('Supporting Comments:', margin, yPosition, pageWidth - 2 * margin);
                yPosition = addText(supportingComments, margin + 5, yPosition, pageWidth - 2 * margin - 5);
                yPosition += 5;
            }

            // Remarks
            const remarks = document.getElementById('remarks').value;
            if (remarks) {
                if (yPosition > pageHeight - 40) {
                    doc.addPage();
                    yPosition = margin;
                }
                doc.setFont(undefined, 'bold');
                yPosition = addText('REMARKS', margin, yPosition, pageWidth - 2 * margin);
                yPosition += 3;
                doc.setFont(undefined, 'normal');
                yPosition = addText(remarks, margin, yPosition, pageWidth - 2 * margin);
                doc.setFontSize(8);
                doc.setFont(undefined, 'italic');
                yPosition += 3;
                yPosition = addText('(Note: These comments have no legal implications and do not form part of the Entity\'s profile)', margin, yPosition, pageWidth - 2 * margin);
            }

            // Authorized Signature
            if (yPosition > pageHeight - 80) {
                doc.addPage();
                yPosition = margin;
            }
            yPosition += 5;
            doc.setFontSize(11);
            doc.setFont(undefined, 'bold');
            yPosition = addText('AUTHORIZED SIGNATURE', margin, yPosition, pageWidth - 2 * margin);
            yPosition += 5;
            doc.setFontSize(10);
            doc.setFont(undefined, 'normal');
            
            const signatoryName = document.getElementById('signatoryName').value;
            const signatoryTitle = document.getElementById('signatoryTitle').value;
            const signatureDate = document.getElementById('signatureDate').value;
            
            yPosition = addText(`Signatory Name: ${signatoryName}`, margin, yPosition, pageWidth - 2 * margin);
            yPosition = addText(`Title/Position: ${signatoryTitle}`, margin, yPosition, pageWidth - 2 * margin);
            yPosition = addText(`Date: ${signatureDate}`, margin, yPosition, pageWidth - 2 * margin);
            yPosition += 5;
            
            // Add signature image
            const signatureImage = getSignatureImage();
            doc.addImage(signatureImage, 'PNG', margin, yPosition, 80, 20);
            yPosition += 25;

            // Save PDF
            const fileName = `ES_Declaration_${document.getElementById('entityName').value.replace(/\s+/g, '_')}_${new Date().toISOString().split('T')[0]}.pdf`;
            doc.save(fileName);

            // Hide loading spinner
            document.getElementById('loadingSpinner').style.display = 'none';
            
                } catch (error) {
                    console.error('PDF generation error:', error);
                    alert('An error occurred while generating the PDF. Please try again or contact support if the problem persists.');
                    document.getElementById('loadingSpinner').style.display = 'none';
                }
            }, 100); // End of setTimeout
        }
    </script>
</body>
</html>
